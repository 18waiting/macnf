# é˜Ÿåˆ—ç´¢å¼• + æ™ºèƒ½åŒæ­¥æ–¹æ¡ˆï¼šè¯¦ç»†è¿ä½œæµç¨‹

## ğŸ“‹ ç›®å½•

1. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
2. [æ•°æ®æ¨¡å‹](#æ•°æ®æ¨¡å‹)
3. [æ­£å¸¸æ»‘åŠ¨æµç¨‹](#æ­£å¸¸æ»‘åŠ¨æµç¨‹)
4. [æå‰æŒæ¡æµç¨‹](#æå‰æŒæ¡æµç¨‹)
5. [æ™ºèƒ½åŒæ­¥æœºåˆ¶](#æ™ºèƒ½åŒæ­¥æœºåˆ¶)
6. [æ•°æ®æµè½¬å›¾](#æ•°æ®æµè½¬å›¾)
7. [è¾¹ç•Œæƒ…å†µå¤„ç†](#è¾¹ç•Œæƒ…å†µå¤„ç†)

---

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### é˜Ÿåˆ—ç´¢å¼•æ˜ å°„

**æ ¸å¿ƒæ€æƒ³**ï¼šKoloda çš„ç´¢å¼•ç›´æ¥å¯¹åº” `StudyViewModel.queue` çš„ç´¢å¼•ã€‚

```
Koloda ç´¢å¼• = é˜Ÿåˆ—ç´¢å¼•
0 â†’ queue[0] (ç¬¬ä¸€å¼ å¡ç‰‡)
1 â†’ queue[1] (ç¬¬äºŒå¼ å¡ç‰‡)
2 â†’ queue[2] (ç¬¬ä¸‰å¼ å¡ç‰‡)
...
```

**ä¼˜åŠ¿**ï¼š
- âœ… ç®€å•ç›´æ¥ï¼Œæ— éœ€å¤æ‚æ˜ å°„
- âœ… é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
- âœ… æ€§èƒ½ä¼˜ç§€ï¼Œæ— é¢å¤–è®¡ç®—å¼€é”€

---

## ğŸ“Š æ•°æ®æ¨¡å‹

### å…³é”®æ•°æ®ç»“æ„

#### 1. StudyViewModel.queue
```swift
private var queue: [StudyCard] = [] {
    didSet {
        queueCount = queue.count  // è‡ªåŠ¨æ›´æ–° @Published å±æ€§
    }
}
```

**ä½œç”¨**ï¼šå­˜å‚¨å¾…å­¦ä¹ çš„å¡ç‰‡é˜Ÿåˆ—ã€‚

**å˜åŒ–æ—¶æœº**ï¼š
- åˆå§‹åŒ–æ—¶ï¼šä»æ•°æ®åº“åŠ è½½ä»»åŠ¡ï¼Œç”Ÿæˆé˜Ÿåˆ—
- æ»‘åŠ¨æ—¶ï¼šç§»é™¤å½“å‰å¡ç‰‡ï¼ˆ`queue.removeFirst()`ï¼‰
- æå‰æŒæ¡æ—¶ï¼šç§»é™¤è¯¥å•è¯çš„å…¶ä»–å¡ç‰‡ï¼ˆ`queue.removeAll { ... }`ï¼‰

---

#### 2. StudyViewModel.completedCount
```swift
@Published var completedCount: Int = 0
```

**ä½œç”¨**ï¼šè®°å½•å·²å®Œæˆçš„å¡ç‰‡æ€»æ•°ï¼ˆç”¨äºè¿›åº¦æ˜¾ç¤ºï¼‰ã€‚

**å˜åŒ–æ—¶æœº**ï¼š
- æ­£å¸¸æ»‘åŠ¨ï¼š`completedCount += 1`
- æå‰æŒæ¡ï¼š`completedCount += (1 + earlyMasteredRemovedCount)`

**æ³¨æ„**ï¼š`completedCount` ä»…ç”¨äºè¿›åº¦æ˜¾ç¤ºï¼Œ**ä¸å‚ä¸ç´¢å¼•æ˜ å°„**ã€‚

---

#### 3. KolodaView.currentCardIndex
```swift
var currentCardIndex: Int { get }
```

**ä½œç”¨**ï¼šKoloda å†…éƒ¨ç»´æŠ¤çš„å½“å‰å¡ç‰‡ç´¢å¼•ã€‚

**å˜åŒ–æ—¶æœº**ï¼š
- æ¯æ¬¡æ»‘åŠ¨ï¼šè‡ªåŠ¨ `+1`
- è°ƒç”¨ `resetCurrentCardIndex()`ï¼šé‡ç½®ä¸º `0`

**ç‰¹ç‚¹**ï¼š
- åªè¯»å±æ€§ï¼Œæ— æ³•ç›´æ¥ä¿®æ”¹
- ç´¯ç§¯é€’å¢ï¼Œä¸ä¼šè‡ªåŠ¨å‡å°‘

---

## ğŸ”„ æ­£å¸¸æ»‘åŠ¨æµç¨‹

### åœºæ™¯ï¼šç”¨æˆ·æ»‘åŠ¨ç¬¬ä¸€å¼ å¡ç‰‡ï¼ˆæ— æå‰æŒæ¡ï¼‰

#### åˆå§‹çŠ¶æ€

```
StudyViewModel:
  queue = [Card1, Card2, Card3, Card4, ...]  (100 å¼ )
  queueCount = 100
  completedCount = 0
  visibleCards = [Card1, Card2, Card3]

KolodaView:
  currentCardIndex = 0
  kolodaNumberOfCards() = 100
```

---

#### æ­¥éª¤ 1ï¼šç”¨æˆ·å¼€å§‹æ»‘åŠ¨

**ç”¨æˆ·æ“ä½œ**ï¼šå‘å³æ»‘åŠ¨ Card1

**Koloda å†…éƒ¨**ï¼š
- æ£€æµ‹åˆ°æ»‘åŠ¨æ‰‹åŠ¿
- å¼€å§‹åŠ¨ç”»
- è°ƒç”¨ `draggedCardWithPercentage(_:in:)` æ›´æ–°æ–¹å‘æŒ‡ç¤ºå™¨

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 0  (æœªå˜åŒ–)
queue = [Card1, Card2, Card3, ...]  (æœªå˜åŒ–)
```

---

#### æ­¥éª¤ 2ï¼šæ»‘åŠ¨å®Œæˆï¼Œè§¦å‘å›è°ƒ

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:didSwipeCardAt:in:)
  index = 0  // Koloda ç´¢å¼•
```

**KolodaCardsCoordinator å¤„ç†**ï¼š
```swift
let queueIndex = index  // 0
let card = viewModel.getCard(at: queueIndex)  // Card1
let dwellTime = viewModel.dwellTimeTracker.stopTracking()
onSwipe(card.word.id, .right, dwellTime)
```

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 0  (å³å°†å˜ä¸º 1)
queue = [Card1, Card2, Card3, ...]  (å³å°†ç§»é™¤ Card1)
```

---

#### æ­¥éª¤ 3ï¼šStudyViewModel.handleSwipe å¤„ç†

**æ‰§è¡Œæµç¨‹**ï¼š
```swift
// 1. æ›´æ–°å­¦ä¹ è®°å½•
learningRecords[wordId].recordSwipe(direction, dwellTime)

// 2. æ£€æŸ¥æå‰æŒæ¡ï¼ˆæœ¬ä¾‹ä¸­ï¼šfalseï¼‰
if !exposureStrategy.shouldContinueExposure(...) {
    // ä¸æ‰§è¡Œ
}

// 3. æ›´æ–°ç»Ÿè®¡
completedCount += 1  // 0 â†’ 1

// 4. ä»é˜Ÿåˆ—ç§»é™¤å½“å‰å¡ç‰‡
queue.removeFirst()  // ç§»é™¤ Card1

// 5. æ›´æ–°å¯è§å¡ç‰‡
visibleCards = Array(queue.prefix(3))  // [Card2, Card3, Card4]
```

**æ•°æ®å˜åŒ–**ï¼š
```
Before:
  queue = [Card1, Card2, Card3, Card4, ...]  (100 å¼ )
  queueCount = 100
  completedCount = 0
  visibleCards = [Card1, Card2, Card3]

After:
  queue = [Card2, Card3, Card4, ...]  (99 å¼ )
  queueCount = 99  (è‡ªåŠ¨æ›´æ–°ï¼Œè§¦å‘ @Published)
  completedCount = 1
  visibleCards = [Card2, Card3, Card4]
```

---

#### æ­¥éª¤ 4ï¼šKoloda ç´¢å¼•é€’å¢

**Koloda å†…éƒ¨**ï¼š
- æ»‘åŠ¨åŠ¨ç”»å®Œæˆ
- `currentCardIndex` è‡ªåŠ¨é€’å¢ï¼š`0 â†’ 1`
- è°ƒç”¨ `koloda(_:didShowCardAt:)` æ˜¾ç¤ºä¸‹ä¸€å¼ å¡ç‰‡

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 1
queue = [Card2, Card3, Card4, ...]  (99 å¼ )
queueCount = 99
```

---

#### æ­¥éª¤ 5ï¼šæ˜¾ç¤ºä¸‹ä¸€å¼ å¡ç‰‡

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:viewForCardAt:)
  index = 1  // Koloda ç´¢å¼•
```

**KolodaCardsCoordinator å¤„ç†**ï¼š
```swift
let queueIndex = index  // 1
let card = viewModel.getCard(at: queueIndex)  // Card2
// è¿”å› Card2 çš„è§†å›¾
```

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 1
queue = [Card2, Card3, Card4, ...]  (99 å¼ )
queueCount = 99
```

**ç»“æœ**ï¼šâœ… æ­£å¸¸æ˜¾ç¤º Card2ï¼Œç´¢å¼•åŒæ­¥æ­£å¸¸ã€‚

---

## ğŸš€ æå‰æŒæ¡æµç¨‹

### åœºæ™¯ï¼šç”¨æˆ·æ»‘åŠ¨æ—¶è§¦å‘æå‰æŒæ¡ï¼ˆç§»é™¤ 5 å¼ å¡ç‰‡ï¼‰

#### åˆå§‹çŠ¶æ€

```
StudyViewModel:
  queue = [Card1, Card2, Card3, Card4, Card5, Card6, Card7, ...]  (100 å¼ )
  queueCount = 100
  completedCount = 0
  visibleCards = [Card1, Card2, Card3]

KolodaView:
  currentCardIndex = 0
  kolodaNumberOfCards() = 100
```

**å‡è®¾**ï¼šCard1, Card2, Card3, Card4, Card5, Card6 éƒ½æ˜¯åŒä¸€ä¸ªå•è¯ï¼ˆwordId=10ï¼‰ï¼Œéœ€è¦æ›å…‰ 6 æ¬¡ã€‚

---

#### æ­¥éª¤ 1ï¼šç”¨æˆ·æ»‘åŠ¨ Card1

**ç”¨æˆ·æ“ä½œ**ï¼šå‘å³æ»‘åŠ¨ Card1

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:didSwipeCardAt:in:)
  index = 0
```

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 0  (å³å°†å˜ä¸º 1)
queue = [Card1, Card2, Card3, Card4, Card5, Card6, ...]  (100 å¼ )
```

---

#### æ­¥éª¤ 2ï¼šStudyViewModel.handleSwipe å¤„ç†

**æ‰§è¡Œæµç¨‹**ï¼š
```swift
// 1. æ›´æ–°å­¦ä¹ è®°å½•
learningRecords[10].recordSwipe(.right, dwellTime)
// å‡è®¾ï¼šrightSwipeCount = 3, avgDwellTime = 5.0s
// è§¦å‘æå‰æŒæ¡æ¡ä»¶

// 2. æ£€æŸ¥æå‰æŒæ¡
if !exposureStrategy.shouldContinueExposure(...) {
    // âœ… æå‰æŒæ¡ï¼
    // ç§»é™¤è¯¥å•è¯çš„å…¶ä»–å¡ç‰‡ï¼ˆCard2, Card3, Card4, Card5, Card6ï¼‰
    queue.removeAll { card in
        card.word.id == 10 && card.id != currentCardId
    }
    earlyMasteredRemovedCount = 5  // ç§»é™¤äº† 5 å¼ 
}

// 3. æ›´æ–°ç»Ÿè®¡
completedCount += (1 + 5)  // 0 â†’ 6

// 4. ä»é˜Ÿåˆ—ç§»é™¤å½“å‰å¡ç‰‡
queue.removeFirst()  // ç§»é™¤ Card1

// 5. æ›´æ–°å¯è§å¡ç‰‡
visibleCards = Array(queue.prefix(3))  // [Card7, Card8, Card9]
```

**æ•°æ®å˜åŒ–**ï¼š
```
Before:
  queue = [Card1, Card2, Card3, Card4, Card5, Card6, Card7, ...]  (100 å¼ )
  queueCount = 100
  completedCount = 0

After:
  queue = [Card7, Card8, Card9, ...]  (94 å¼ )  // ç§»é™¤äº† Card1-6
  queueCount = 94  (è‡ªåŠ¨æ›´æ–°)
  completedCount = 6
  visibleCards = [Card7, Card8, Card9]
```

**å…³é”®ç‚¹**ï¼š
- é˜Ÿåˆ—ä» 100 å¼ å‡å°‘åˆ° 94 å¼ ï¼ˆå‡å°‘äº† 6 å¼ ï¼‰
- `completedCount` ä» 0 è·³åˆ° 6
- ä½† `KolodaView.currentCardIndex` åªä» 0 è·³åˆ° 1

---

#### æ­¥éª¤ 3ï¼šKoloda ç´¢å¼•é€’å¢

**Koloda å†…éƒ¨**ï¼š
- æ»‘åŠ¨åŠ¨ç”»å®Œæˆ
- `currentCardIndex` è‡ªåŠ¨é€’å¢ï¼š`0 â†’ 1`
- è°ƒç”¨ `koloda(_:didShowCardAt:)` æ˜¾ç¤ºä¸‹ä¸€å¼ å¡ç‰‡

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 1
queue = [Card7, Card8, Card9, ...]  (94 å¼ )
queueCount = 94
```

**é—®é¢˜**ï¼šâŒ ç´¢å¼•ä¸åŒæ­¥ï¼
- Koloda è®¤ä¸ºï¼šç´¢å¼• 1 å¯¹åº” `queue[1]`ï¼ˆCard8ï¼‰
- å®é™…åº”è¯¥ï¼šç´¢å¼• 0 å¯¹åº” `queue[0]`ï¼ˆCard7ï¼‰

---

#### æ­¥éª¤ 4ï¼šæ˜¾ç¤ºä¸‹ä¸€å¼ å¡ç‰‡ï¼ˆç´¢å¼•ä¸åŒæ­¥ï¼‰

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:viewForCardAt:)
  index = 1  // Koloda ç´¢å¼•
```

**KolodaCardsCoordinator å¤„ç†**ï¼š
```swift
let queueIndex = index  // 1
let card = viewModel.getCard(at: queueIndex)  // Card8
// è¿”å› Card8 çš„è§†å›¾
```

**ç»“æœ**ï¼šâŒ æ˜¾ç¤ºçš„æ˜¯ Card8ï¼Œè€Œä¸æ˜¯ Card7ï¼ˆåº”è¯¥æ˜¾ç¤ºçš„ç¬¬ä¸€å¼ å¡ç‰‡ï¼‰

---

#### æ­¥éª¤ 5ï¼šupdateUIView æ£€æµ‹å¹¶åŒæ­¥

**SwiftUI æ›´æ–°**ï¼š
- `queueCount` å˜åŒ–ï¼ˆ100 â†’ 94ï¼‰è§¦å‘ `@Published` æ›´æ–°
- `updateUIView` è¢«è°ƒç”¨

**æ£€æµ‹é€»è¾‘**ï¼š
```swift
let currentQueueCount = viewModel.queueCount  // 94
let currentKolodaIndex = uiView.currentCardIndex  // 1

if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // âŒ 1 >= 94 ä¸º falseï¼Œä¸æ‰§è¡Œ
}
```

**é—®é¢˜**ï¼šç´¢å¼• 1 æ²¡æœ‰è¶…å‡ºèŒƒå›´ï¼ˆ1 < 94ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘åŒæ­¥ï¼

**å®é™…æƒ…å†µ**ï¼š
- ç´¢å¼• 1 å¯¹åº” `queue[1]`ï¼ˆCard8ï¼‰
- ä½†åº”è¯¥æ˜¾ç¤º `queue[0]`ï¼ˆCard7ï¼‰
- è¿™æ˜¯**ç´¢å¼•æ»å**é—®é¢˜ï¼Œä¸æ˜¯ç´¢å¼•è¶…å‡ºé—®é¢˜

---

#### æ­¥éª¤ 6ï¼šç»§ç»­æ»‘åŠ¨ï¼Œç´¢å¼•é€æ¸åŒæ­¥

**ç”¨æˆ·æ“ä½œ**ï¼šç»§ç»­æ»‘åŠ¨ Card8

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:didSwipeCardAt:in:)
  index = 1
```

**StudyViewModel.handleSwipe**ï¼š
```swift
queue.removeFirst()  // ç§»é™¤ Card7ï¼ˆå®é™…çš„ç¬¬ä¸€å¼ ï¼‰
queueCount = 93
```

**Koloda ç´¢å¼•é€’å¢**ï¼š
```
currentCardIndex: 1 â†’ 2
```

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 2
queue = [Card8, Card9, ...]  (93 å¼ )
queueCount = 93
```

**ç»“æœ**ï¼šç´¢å¼•é€æ¸åŒæ­¥ï¼Œä½†ä¼šè·³è¿‡ Card7ã€‚

---

## ğŸ”§ æ™ºèƒ½åŒæ­¥æœºåˆ¶

### é—®é¢˜åˆ†æ

**æå‰æŒæ¡å¯¼è‡´çš„é—®é¢˜**ï¼š
1. é˜Ÿåˆ—çªç„¶å‡å°‘ï¼ˆ100 â†’ 94ï¼‰
2. Koloda ç´¢å¼•åªé€’å¢ 1ï¼ˆ0 â†’ 1ï¼‰
3. ç´¢å¼•æ»åï¼šåº”è¯¥æ˜¾ç¤º `queue[0]`ï¼Œä½†æ˜¾ç¤ºçš„æ˜¯ `queue[1]`

**å½“å‰æ£€æµ‹é€»è¾‘çš„å±€é™æ€§**ï¼š
```swift
if currentKolodaIndex >= currentQueueCount {
    // åªæ£€æµ‹"ç´¢å¼•è¶…å‡º"ï¼Œä¸æ£€æµ‹"ç´¢å¼•æ»å"
}
```

---

### æ”¹è¿›æ–¹æ¡ˆï¼šæ£€æµ‹ç´¢å¼•æ»å

**æ ¸å¿ƒæ€æƒ³**ï¼šå½“é˜Ÿåˆ—å‡å°‘æ—¶ï¼Œæ£€æµ‹ Koloda ç´¢å¼•æ˜¯å¦æ»åï¼Œå¹¶é‡ç½®åˆ°é˜Ÿåˆ—ç¬¬ä¸€å¼ ã€‚

**å®ç°**ï¼š
```swift
func updateUIView(_ uiView: KolodaView, context: Context) {
    let currentQueueCount = viewModel.queueCount
    let currentKolodaIndex = uiView.currentCardIndex
    
    // æƒ…å†µ 1ï¼šç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆæœ€å¸¸è§ï¼‰
    if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
        // é‡ç½®ç´¢å¼•åˆ° 0ï¼ˆé˜Ÿåˆ—ç¬¬ä¸€å¼ ï¼‰
        uiView.resetCurrentCardIndex()
        return
    }
    
    // æƒ…å†µ 2ï¼šç´¢å¼•æ»åï¼ˆæå‰æŒæ¡å¯¼è‡´ï¼‰
    // æ£€æµ‹ï¼šå¦‚æœé˜Ÿåˆ—åˆšå‡å°‘ï¼Œä¸” Koloda ç´¢å¼• > 0
    // ä½†å®é™…åº”è¯¥æ˜¾ç¤ºé˜Ÿåˆ—ç¬¬ä¸€å¼ ï¼ˆç´¢å¼• 0ï¼‰
    // æ³¨æ„ï¼šè¿™ä¸ªæ£€æµ‹éœ€è¦é¢å¤–çš„çŠ¶æ€è·Ÿè¸ª
}
```

---

### å®é™…è¿ä½œæµç¨‹ï¼ˆæ”¹è¿›åï¼‰

#### æ­¥éª¤ 1-3ï¼šåŒå‰ï¼ˆæå‰æŒæ¡ï¼Œé˜Ÿåˆ—å‡å°‘ï¼‰

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 1
queue = [Card7, Card8, Card9, ...]  (94 å¼ )
queueCount = 94
```

---

#### æ­¥éª¤ 4ï¼šupdateUIView æ£€æµ‹å¹¶åŒæ­¥

**æ£€æµ‹é€»è¾‘**ï¼š
```swift
let currentQueueCount = viewModel.queueCount  // 94
let currentKolodaIndex = uiView.currentCardIndex  // 1

// æƒ…å†µ 1ï¼šç´¢å¼•è¶…å‡ºèŒƒå›´
if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // 1 >= 94 ä¸º falseï¼Œä¸æ‰§è¡Œ
}

// æƒ…å†µ 2ï¼šç´¢å¼•æ»åï¼ˆéœ€è¦é¢å¤–æ£€æµ‹ï¼‰
// å‡è®¾ï¼šæˆ‘ä»¬è·Ÿè¸ªäº†ä¸Šæ¬¡çš„ queueCount
let lastQueueCount = coordinator.lastQueueCount  // 100
if lastQueueCount > currentQueueCount && currentKolodaIndex > 0 {
    // é˜Ÿåˆ—å‡å°‘äº†ï¼Œä¸” Koloda ç´¢å¼• > 0
    // é‡ç½®ç´¢å¼•åˆ° 0
    uiView.resetCurrentCardIndex()
    coordinator.lastQueueCount = currentQueueCount
}
```

**æ‰§è¡Œç»“æœ**ï¼š
```swift
uiView.resetCurrentCardIndex()
// Koloda å†…éƒ¨ï¼šcurrentCardIndex = 0
```

**æ•°æ®çŠ¶æ€**ï¼š
```
KolodaView.currentCardIndex = 0  (å·²é‡ç½®)
queue = [Card7, Card8, Card9, ...]  (94 å¼ )
queueCount = 94
```

---

#### æ­¥éª¤ 5ï¼šæ˜¾ç¤ºæ­£ç¡®çš„å¡ç‰‡

**Koloda è°ƒç”¨**ï¼š
```swift
koloda(_:viewForCardAt:)
  index = 0  // å·²é‡ç½®
```

**KolodaCardsCoordinator å¤„ç†**ï¼š
```swift
let queueIndex = index  // 0
let card = viewModel.getCard(at: queueIndex)  // Card7
// è¿”å› Card7 çš„è§†å›¾
```

**ç»“æœ**ï¼šâœ… æ˜¾ç¤º Card7ï¼ˆé˜Ÿåˆ—ç¬¬ä¸€å¼ ï¼‰ï¼Œç´¢å¼•åŒæ­¥æˆåŠŸï¼

---

## ğŸ“ˆ æ•°æ®æµè½¬å›¾

### æ­£å¸¸æ»‘åŠ¨æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹çŠ¶æ€                                                      â”‚
â”‚ queue = [Card1, Card2, Card3, ...] (100 å¼ )                 â”‚
â”‚ queueCount = 100                                             â”‚
â”‚ currentKolodaIndex = 0                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ ç”¨æˆ·æ»‘åŠ¨ Card1
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Koloda è°ƒç”¨ didSwipeCardAt(0)                                â”‚
â”‚ queueIndex = 0 â†’ Card1                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ handleSwipe
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StudyViewModel å¤„ç†                                           â”‚
â”‚ 1. æ›´æ–°å­¦ä¹ è®°å½•                                               â”‚
â”‚ 2. completedCount += 1 (0 â†’ 1)                              â”‚
â”‚ 3. queue.removeFirst() (ç§»é™¤ Card1)                           â”‚
â”‚ 4. queueCount = 99 (è‡ªåŠ¨æ›´æ–°)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ @Published è§¦å‘æ›´æ–°
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SwiftUI æ›´æ–°                                                  â”‚
â”‚ updateUIView è¢«è°ƒç”¨                                           â”‚
â”‚ currentKolodaIndex = 0, queueCount = 99                       â”‚
â”‚ 0 < 99 âœ… åŒæ­¥æ­£å¸¸ï¼Œæ— éœ€æ“ä½œ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Koloda ç´¢å¼•é€’å¢
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€ç»ˆçŠ¶æ€                                                      â”‚
â”‚ queue = [Card2, Card3, Card4, ...] (99 å¼ )                   â”‚
â”‚ queueCount = 99                                              â”‚
â”‚ currentKolodaIndex = 1                                       â”‚
â”‚ âœ… ç´¢å¼•åŒæ­¥æ­£å¸¸ï¼š1 < 99                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æå‰æŒæ¡æµç¨‹ï¼ˆå½“å‰å®ç°ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹çŠ¶æ€                                                      â”‚
â”‚ queue = [Card1-6(åŒä¸€å•è¯), Card7, ...] (100 å¼ )              â”‚
â”‚ queueCount = 100                                             â”‚
â”‚ currentKolodaIndex = 0                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ ç”¨æˆ·æ»‘åŠ¨ Card1ï¼Œè§¦å‘æå‰æŒæ¡
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StudyViewModel.handleSwipe                                    â”‚
â”‚ 1. æ£€æµ‹æå‰æŒæ¡ âœ…                                            â”‚
â”‚ 2. queue.removeAll { wordId == 10 } (ç§»é™¤ Card2-6)           â”‚
â”‚ 3. queue.removeFirst() (ç§»é™¤ Card1)                          â”‚
â”‚ 4. queueCount = 94 (100 â†’ 94)                                 â”‚
â”‚ 5. completedCount = 6 (0 â†’ 6)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Koloda ç´¢å¼•é€’å¢
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¢å¼•ä¸åŒæ­¥çŠ¶æ€                                                 â”‚
â”‚ queue = [Card7, Card8, ...] (94 å¼ )                          â”‚
â”‚ queueCount = 94                                              â”‚
â”‚ currentKolodaIndex = 1  âŒ åº”è¯¥ä¸º 0                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ updateUIView æ£€æµ‹
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ£€æµ‹ç»“æœ                                                      â”‚
â”‚ currentKolodaIndex = 1                                       â”‚
â”‚ queueCount = 94                                              â”‚
â”‚ 1 < 94 âœ… æœªè¶…å‡ºèŒƒå›´ï¼Œä¸æ‰§è¡ŒåŒæ­¥                               â”‚
â”‚ âŒ ä½†ç´¢å¼•æ»åï¼šåº”è¯¥æ˜¾ç¤º queue[0]ï¼Œå®é™…æ˜¾ç¤º queue[1]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ ç»§ç»­æ»‘åŠ¨ï¼Œé€æ¸åŒæ­¥
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€ç»ˆåŒæ­¥ï¼ˆéœ€è¦å¤šæ¬¡æ»‘åŠ¨ï¼‰                                       â”‚
â”‚ queue = [Card9, ...] (93 å¼ )                                 â”‚
â”‚ currentKolodaIndex = 2                                       â”‚
â”‚ âœ… ç´¢å¼•é€æ¸åŒæ­¥ï¼Œä½†ä¼šè·³è¿‡ Card7                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### æå‰æŒæ¡æµç¨‹ï¼ˆæ”¹è¿›åï¼šæ™ºèƒ½åŒæ­¥ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹çŠ¶æ€ï¼ˆåŒå‰ï¼‰                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ ç”¨æˆ·æ»‘åŠ¨ Card1ï¼Œè§¦å‘æå‰æŒæ¡
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StudyViewModel.handleSwipeï¼ˆåŒå‰ï¼‰                            â”‚
â”‚ queueCount = 94 (100 â†’ 94)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ @Published è§¦å‘æ›´æ–°
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ updateUIView æ£€æµ‹                                             â”‚
â”‚ currentKolodaIndex = 1                                       â”‚
â”‚ queueCount = 94                                              â”‚
â”‚ lastQueueCount = 100 (è·Ÿè¸ªä¸Šæ¬¡çš„å€¼)                           â”‚
â”‚                                                              â”‚
â”‚ æ£€æµ‹ï¼šlastQueueCount > queueCount && currentKolodaIndex > 0 â”‚
â”‚ 100 > 94 && 1 > 0 âœ… ç´¢å¼•æ»åï¼                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ æ‰§è¡ŒåŒæ­¥
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ resetCurrentCardIndex()                                       â”‚
â”‚ currentKolodaIndex = 0 (å·²é‡ç½®)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Koloda è¯·æ±‚å¡ç‰‡
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ viewForCardAt(0)                                             â”‚
â”‚ queueIndex = 0 â†’ Card7 âœ… æ­£ç¡®ï¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœ€ç»ˆçŠ¶æ€                                                      â”‚
â”‚ queue = [Card7, Card8, ...] (94 å¼ )                          â”‚
â”‚ currentKolodaIndex = 0                                       â”‚
â”‚ âœ… ç´¢å¼•åŒæ­¥æˆåŠŸï¼šæ˜¾ç¤º queue[0]ï¼ˆCard7ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ è¾¹ç•Œæƒ…å†µå¤„ç†

### æƒ…å†µ 1ï¼šé˜Ÿåˆ—ä¸ºç©º

**åœºæ™¯**ï¼šæ‰€æœ‰å¡ç‰‡éƒ½å·²å®Œæˆ

**æ•°æ®çŠ¶æ€**ï¼š
```
queue = []
queueCount = 0
currentKolodaIndex = 10  (å‡è®¾)
```

**å¤„ç†**ï¼š
```swift
if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // 0 > 0 ä¸º falseï¼Œä¸æ‰§è¡Œ
}
// Koloda ä¼šè°ƒç”¨ kolodaDidRunOutOfCards
```

**ç»“æœ**ï¼šâœ… Koloda æ­£å¸¸å¤„ç†"å¡ç‰‡ç”¨å®Œ"çš„æƒ…å†µã€‚

---

### æƒ…å†µ 2ï¼šç´¢å¼•ä¸º 0ï¼Œé˜Ÿåˆ—æœ‰å¡ç‰‡

**åœºæ™¯**ï¼šæ­£å¸¸æƒ…å†µ

**æ•°æ®çŠ¶æ€**ï¼š
```
queue = [Card1, Card2, ...] (50 å¼ )
queueCount = 50
currentKolodaIndex = 0
```

**å¤„ç†**ï¼š
```swift
if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // 0 >= 50 ä¸º falseï¼Œä¸æ‰§è¡Œ
}
```

**ç»“æœ**ï¼šâœ… æ­£å¸¸æ˜¾ç¤º Card1ï¼Œæ— éœ€æ“ä½œã€‚

---

### æƒ…å†µ 3ï¼šç´¢å¼•è¶…å‡ºèŒƒå›´ï¼ˆæœ€å¸¸è§ï¼‰

**åœºæ™¯**ï¼šæå‰æŒæ¡å¯¼è‡´é˜Ÿåˆ—å‡å°‘

**æ•°æ®çŠ¶æ€**ï¼š
```
queue = [Card1, Card2, ...] (50 å¼ )
queueCount = 50
currentKolodaIndex = 60  (è¶…å‡ºèŒƒå›´)
```

**å¤„ç†**ï¼š
```swift
if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // 60 >= 50 âœ… æ‰§è¡ŒåŒæ­¥
    uiView.resetCurrentCardIndex()
}
```

**ç»“æœ**ï¼šâœ… é‡ç½®ç´¢å¼•åˆ° 0ï¼Œæ˜¾ç¤º Card1ã€‚

---

### æƒ…å†µ 4ï¼šé€€å‡ºå†è¿›å…¥

**åœºæ™¯**ï¼šç”¨æˆ·é€€å‡ºå¡ç‰‡ç•Œé¢ï¼Œå†è¿›å…¥

**æ•°æ®çŠ¶æ€**ï¼š
```
queue = [Card1, Card2, ...] (50 å¼ )
queueCount = 50
currentKolodaIndex = 0  (Koloda é‡ç½®)
```

**å¤„ç†**ï¼š
```swift
if currentQueueCount > 0 && currentKolodaIndex >= currentQueueCount {
    // 0 >= 50 ä¸º falseï¼Œä¸æ‰§è¡Œ
}
```

**ç»“æœ**ï¼šâœ… æ­£å¸¸æ˜¾ç¤º Card1ï¼Œæ— éœ€æ“ä½œã€‚

---

## ğŸ“ æ€»ç»“

### æ ¸å¿ƒæµç¨‹

1. **æ­£å¸¸æ»‘åŠ¨**ï¼š
   - Koloda ç´¢å¼• = é˜Ÿåˆ—ç´¢å¼•
   - æ¯æ¬¡æ»‘åŠ¨ï¼šç´¢å¼• +1ï¼Œé˜Ÿåˆ— -1
   - åŒæ­¥æ­£å¸¸ï¼Œæ— éœ€é¢å¤–æ“ä½œ

2. **æå‰æŒæ¡**ï¼š
   - é˜Ÿåˆ—çªç„¶å‡å°‘ï¼ˆ-N å¼ ï¼‰
   - Koloda ç´¢å¼•åª +1
   - ç´¢å¼•æ»åï¼šéœ€è¦æ™ºèƒ½åŒæ­¥

3. **æ™ºèƒ½åŒæ­¥**ï¼š
   - æ£€æµ‹ç´¢å¼•è¶…å‡ºèŒƒå›´ï¼š`currentKolodaIndex >= queueCount`
   - æ£€æµ‹ç´¢å¼•æ»åï¼š`lastQueueCount > queueCount && currentKolodaIndex > 0`
   - æ‰§è¡ŒåŒæ­¥ï¼š`resetCurrentCardIndex()`

### æ•°æ®æµè½¬å…³é”®ç‚¹

1. **@Published è§¦å‘æ›´æ–°**ï¼š`queueCount` å˜åŒ– â†’ `updateUIView` è¢«è°ƒç”¨
2. **ç´¢å¼•æ˜ å°„**ï¼šKoloda ç´¢å¼•ç›´æ¥å¯¹åº”é˜Ÿåˆ—ç´¢å¼•ï¼Œæ— éœ€å¤æ‚æ˜ å°„
3. **æ™ºèƒ½åŒæ­¥**ï¼šåªåœ¨å¿…è¦æ—¶ï¼ˆç´¢å¼•è¶…å‡ºæˆ–æ»åï¼‰æ‰é‡ç½®ï¼Œä¿æŒæµç•…

### ä¼˜åŠ¿

- âœ… **ç®€å•ç›´æ¥**ï¼šé˜Ÿåˆ—ç´¢å¼•æ˜ å°„ï¼Œé€»è¾‘æ¸…æ™°
- âœ… **æ€§èƒ½ä¼˜ç§€**ï¼šå¤§å¤šæ•°æƒ…å†µä¸‹ä¸åšä»»ä½•æ“ä½œ
- âœ… **ç¨³å®šæ€§é«˜**ï¼šå®Œæ•´çš„è¾¹ç•Œæ£€æŸ¥ï¼Œä¸ä¼šå‡ºé”™
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**ï¼šæ— æ„ŸçŸ¥åŒæ­¥ï¼Œæµç•…è‡ªç„¶

