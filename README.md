# NFwords - 沉浸式画框卡片单词学习应用

## 🎨 设计理念

作为一款**为应试考试而生**的单词学习应用，NFwords 的核心定位是：

**「Tinder式滑卡 + 目标导向（10天3000词）+ 停留时间智能排序 + 考研风格AI短文」**

### 核心定位

**目标用户**：大学生、研究生等需要在**短期内（2-6个月）**通过应试考试（CET-4/6、考研、TOEFL等）的学习者

**四大核心创新**：
1. 🎯 **Tinder式交互**：左右滑动判断会/不会，流畅有趣
2. 🎯 **目标导向**：10天3000词，清晰明确的学习目标
3. 📊 **停留排序**：智能发现薄弱环节，优先复习
4. 📖 **AI考研短文**：用最陌生的10个词生成考研风格阅读

**核心理念**：
- 🎯 **短期记忆优化**：专注于2-6个月的短期记忆，而非长期保持
- 📊 **量变引起质变**：摒弃艾宾浩斯曲线，通过高频重复（10-20次）实现质的飞跃
- ⏱️ **停留时间反映熟悉度**：精确记录每个单词的停留时间，作为熟悉度的核心指标
- 📖 **考研风格阅读强化**：用困难词汇生成符合考研阅读风格的短文，实战演练
- 📅 **任务预定制**：10天背3000词，算法提前安排每日任务，无需纠结

**设计灵感来源：**
- **Tinder式交互**：应用于**学习卡片界面** - 流畅的卡片堆叠、直观的左右滑动、清晰的方向反馈
- **墨墨式界面**：应用于**词库选择、个人中心、统计复盘** - 科学的词库管理、详细的统计分析、清晰的学习计划

用户不再被复杂的等级系统和进度条所困扰，而是专注于**滑卡即学习**的核心体验。

### 核心设计哲学

- **🃏 Tinder式学习页**：卡片堆叠3层、左右滑动判断、±15°旋转、方向图标提示（仅用于学习界面）
- **📚 墨墨式管理页**：词库选择、学习计划、统计复盘、个人设置（借鉴墨墨的界面设计）
- **🌊 流动式学习**：打开即学，无模式切换，刷卡即进步
- **🧠 思维化沉浸**：从L1（母语）到L2（目标语言）的渐进式淡化
- **🎯 无刻度设计**：前台只显示"今日曝光数"与"剩余出现次数"
- **🎭 氛围感优先**：微场景、发音节奏、60fps流畅动画营造沉浸感

---

## 📋 目录

- [一、应用框架设计](#一应用框架设计)
- [二、MVP核心共识](#二mvp核心共识)
- [三、Tinder式学习卡片交互](#三tinder式学习卡片交互)
- [四、墨墨式界面设计](#四墨墨式界面设计)
- [五、停留时间追踪系统](#五停留时间追踪系统)
- [六、学习计划与任务调度](#六学习计划与任务调度)
- [七、L1→L2渐隐规则](#七l1l2渐隐规则)
- [八、氛围感设计](#八氛围感设计)
- [九、AI内容增强（DeepSeek）](#九ai内容增强deepseek)
- [十、复盘与洞察](#十复盘与洞察)
- [十一、用户认证系统](#十一用户认证系统)
- [十二、技术架构](#十二技术架构)
- [十三、数据与隐私](#十三数据与隐私)

---

## 一、应用框架设计

### 1.1 整体架构概览

NFwords采用**Tab导航**结构，将Tinder式交互和墨墨式界面有机结合：

```
┌─────────────────────────────────────────────┐
│                 NFwords                     │
├─────────────────────────────────────────────┤
│                                             │
│          [主内容区域]                        │
│                                             │
│                                             │
├─────────────────────────────────────────────┤
│  [学习] [词库] [统计] [我的]                │  ← Tab导航栏
└─────────────────────────────────────────────┘
```

### 1.2 四大主要页面

| Tab | 页面名称 | 设计风格 | 核心功能 |
|-----|---------|---------|---------|
| 🎯 | 学习页 | **Tinder式** | 卡片堆叠、左右滑动、快速学习 |
| 📚 | 词库页 | **墨墨式** | 词库选择、学习计划、进度管理 |
| 📊 | 统计页 | **墨墨式** | 学习复盘、数据分析、趋势洞察 |
| 👤 | 我的页 | **墨墨式** | 个人设置、历史记录、成就系统 |

---

### 1.3 页面详细设计

---

## 📱 主界面（启动页/学习Tab首页）

### 设计原则
- **目标导向**：清晰显示当前学习目标和进度
- **一键开始**：直接开始今日学习，无需多余操作
- **数据可视化**：进度条、额度、统计数据一目了然

### 页面布局（参考总览设计）
```
┌─────────────────────────────────────────────┐
│  👤 头像      NFwords           ⚙️ 设置     │  ← 导航栏
├─────────────────────────────────────────────┤
│                                             │
│  💰 额度剩余：6,120 个                       │
│                                             │
│  📊 当前学习目标                             │
│  ┌───────────────────────────────────────┐ │
│  │  🎯 10天背完 CET-4                    │ │
│  │                                       │ │
│  │  进度：第 3 天 / 共 10 天              │ │
│  │  ━━━━━━━━━━░░░░░░░░░░ 30%            │ │
│  │  已学：900 / 3,000 词                 │ │
│  │                                       │ │
│  │  剩余天数：7 天                        │ │
│  │  预计完成：2025-11-14                 │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  📅 今日任务（第 3 天）                      │
│  ┌───────────────────────────────────────┐ │
│  │  • 新词：300 个                        │ │
│  │  • 复习：20 个（昨日停留最长）         │ │
│  │  • 总曝光：约 3,100 次                 │ │
│  │  • 预计时长：45 分钟                   │ │
│  │                                       │ │
│  │  ━━━━░░░░░░░░░░░░░░░░ 10%           │ │
│  │  已完成：310 / 3,100                  │ │
│  │                                       │ │
│  │       [开始今日学习]                   │ │
│  │                                       │ │
│  │  预计剩余时间：40 分钟                 │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  📊 昨日学习数据                             │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  完成曝光        │  │  学习时长        │  │
│  │  3,050次        │  │  45分钟         │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  平均停留        │  │  掌握率          │  │
│  │  3.8秒 ✅       │  │  88%            │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  [查看详细统计]  [调整计划]                 │
│                                             │
│  ────────────────────────────────           │
│                                             │
│  还没有学习目标？                            │
│  [创建新目标]                               │
│                                             │
└─────────────────────────────────────────────┘
```

### 状态说明

#### 有学习目标（进行中）
- 显示当前目标详情
- 显示今日任务
- 一键开始学习
- 显示昨日数据

#### 无学习目标
```
┌─────────────────────────────────────────────┐
│  👤 头像      NFwords           ⚙️ 设置     │
├─────────────────────────────────────────────┤
│                                             │
│  💰 额度剩余：6,120 个                       │
│                                             │
│  🎯 开始您的学习之旅                         │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │                                       │ │
│  │  还没有学习目标                        │ │
│  │  创建一个10天3000词的学习计划吧！      │ │
│  │                                       │ │
│  │       [创建学习目标]                   │ │
│  │                                       │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  推荐计划：                                  │
│  • 🚀 极速突击（7天，3000词）               │
│  • ⚡ 快速冲刺（10天，3000词）✅ 推荐       │
│  • 📚 稳健学习（20天，3000词）              │
│                                             │
└─────────────────────────────────────────────┘
```

#### 目标已完成
```
┌─────────────────────────────────────────────┐
│  🎉 恭喜完成学习目标！                       │
│                                             │
│  10天背完 CET-4 (3,000词)                   │
│  ━━━━━━━━━━━━━━━━━━━━ 100%                 │
│                                             │
│  学习成果：                                  │
│  • 总曝光：31,250 次                        │
│  • 总时长：7小时 30分钟                     │
│  • 平均停留：3.5秒                          │
│  • 掌握率：85%                              │
│                                             │
│  [查看完整报告]  [创建新目标]               │
└─────────────────────────────────────────────┘
```

---

## 📱 Tab 1: 学习页（Tinder式）⭐ 最重要

### 设计原则
- **纯粹的Tinder式交互**：卡片堆叠、左右滑动、零干扰
- **极简界面**：只保留必要信息（单词、音标、剩余次数、进度）
- **流畅动画**：60fps、零延迟跟手、弹性反馈
- **显示剩余次数**：remaining_exposures清晰可见（核心功能）

### 页面布局（参考架构总览设计）
```
┌──────────────────────────────────────────────┐
│  剩 8 次                     进度 50/3100    │  ← 顶部状态栏
├──────────────────────────────────────────────┤
│                                              │
│                                              │
│        ┌────────────────────────┐           │  ← 第3张（最小）
│       ┌┼────────────────────────┼┐          │  ← 第2张（中等）
│      ┌┼┼────────────────────────┼┼┐         │
│      │││                        │││         │
│      │││    abandonment         │││         │  ← 第1张（当前）
│      │││   /əˈbændənmənt/       │││         │
│      │││    n. 放弃，遗弃       │││         │
│      │││                        │││         │
│      │││                        │││         │
│      │││   [点击查看例句]       │││         │
│      │││                        │││         │
│      └┼┼────────────────────────┼┼┘         │
│       └┼────────────────────────┼┘          │
│        └────────────────────────┘           │
│                                              │
│   ←─────────────       ─────────────→       │
│     不会写 ❌              会写 ✅           │  ← 滑动提示
│                                              │
├──────────────────────────────────────────────┤
│    🔊 发音         ↶ 撤回        ⋯ 更多     │  ← 底部工具栏
└──────────────────────────────────────────────┘
```

**关键元素说明**：
- **剩 8 次**：remaining_exposures，这个词还要出现8次
- **进度 50/3100**：当前完成50次/总计3100次曝光（300词×10+20复习×5）
- **n. 放弃，遗弃**：简短的中文释义（根据L1→L2规则动态显示）
- **卡片堆叠**：最多3张，scale分别为 1.0、0.95、0.90

### 交互细节

#### 卡片状态
1. **默认状态**（正面）
   - 显示：单词 + 音标 + 剩余次数
   - 背景：纯白色
   - 阴影：轻微阴影增加层次感

2. **拖动状态**
   - 卡片跟随手指移动
   - 旋转角度：±15°
   - 方向图标淡入：
     - 右滑：绿色 ✓（右上角）
     - 左滑：橙色 ✗（左上角）
   - 背景色渐变：
     - 右滑：绿色渐变
     - 左滑：橙色渐变

3. **翻转状态**（点击卡片中心）
   - 3D翻转动画（0.3s）
   - 显示：释义 + 短语 + 例句
   - 可上下滚动查看更多内容
   - 根据L1→L2规则显示中英文

4. **飞出状态**
   - 右滑：向右飞出屏幕（500pt）
   - 左滑：向左飞出屏幕（-500pt）
   - 透明度：1.0 → 0.0
   - 后方卡片前移动画

#### 手势响应
| 手势 | 触发条件 | 响应 |
|------|---------|------|
| 水平拖动 | 任意方向 | 卡片跟随 + 旋转 + 图标 |
| 释放 | offset > 100 或 velocity > 500 | 卡片飞出 + 记录结果 |
| 释放 | 未达到阈值 | 弹回原位 |
| 点击中心 | 单击 | 3D翻转查看释义 |
| 长按单词 | 长按1秒 | 播放发音 |
| 双击 | 双击卡片 | 快速右滑（认识） |

#### 底部工具栏
```
🔊 发音    - 播放当前单词发音
↶ 撤回     - 撤回上一次操作（恢复上一张卡片）
⋯ 更多     - 显示菜单（标记生词、跳过、查看详情）
```

---

## 📚 Tab 2: 词库页（墨墨式）

### 设计原则
- **借鉴墨墨的词库管理**：清晰的分类、详细的进度、灵活的计划
- **卡片式布局**：每个词库一张卡片，显示关键信息
- **一键开始**：选择词库即可立即开始学习

### 页面布局
```
┌─────────────────────────────────────────────┐
│  📚 我的词库                    ＋ 添加      │  ← 导航栏
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │  ✓ CET-4 核心词汇                   │   │  ← 当前词库
│  │  ━━━━━━━━━━━━━━━━░░ 72%            │   │
│  │  已学 3,240 / 总计 4,500            │   │
│  │  今日新词: 50  |  复习: 120          │   │
│  │                                     │   │
│  │  [继续学习]         [查看详情 →]    │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  推荐词库                                    │
│                                             │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  CET-6          │  │  TOEFL          │  │
│  │  5,500词        │  │  8,000词        │  │
│  │  [开始学习]     │  │  [开始学习]     │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  GRE            │  │  考研核心        │  │
│  │  15,000词       │  │  5,500词        │  │
│  │  [开始学习]     │  │  [开始学习]     │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  自定义词库                                  │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  📥 导入词库                          │ │
│  │  支持：Excel / CSV / TXT              │ │
│  └───────────────────────────────────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

### 创建学习目标（参考总览设计）⭐
```
┌─────────────────────────────────────────────┐
│  ← 返回    创建学习目标                     │
├─────────────────────────────────────────────┤
│                                             │
│  选择词库：                                  │
│  ┌───────────────────────────────────────┐ │
│  │  ✓ CET-4 核心词汇 (3,000词)           │ │
│  │  ○ CET-6 (5,500词)                    │ │
│  │  ○ 考研核心 (5,500词)                 │ │
│  │  ○ TOEFL (8,000词)                    │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  学习周期：                                  │
│  ┌───────────────────────────────────────┐ │
│  │  [ 10 ] 天                             │ │
│  │  ●───────────────────── 快速突击      │ │
│  │  7天  10天  20天  30天  60天           │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ─────────────────────────────────         │
│                                             │
│  📊 系统自动计算：                           │
│                                             │
│  • 每天新词：300 词                         │
│  • 每天复习：约 20-50 词                    │
│  • 每天曝光：约 3,000-3,200 次              │
│  • 预计时长：每天 40-50 分钟                │
│  • 每个单词：预计出现 10 次                 │
│                                             │
│  💰 额度检查：                               │
│  • 需要额度：3,000 个                       │
│  • 剩余额度：6,120 个 ✅                    │
│  • 使用后剩余：3,120 个                     │
│                                             │
│  ─────────────────────────────────         │
│                                             │
│  开始日期：2025-11-04                       │
│  结束日期：2025-11-14                       │
│                                             │
│  [确认创建]  [调整参数]                     │
└─────────────────────────────────────────────┘
```

### 词库卡片详情页（墨墨式）
```
┌─────────────────────────────────────────────┐
│  ← 返回    CET-4 核心词汇          ⚙️ 设置  │
├─────────────────────────────────────────────┤
│                                             │
│  当前学习目标                                │
│  ┌───────────────────────────────────────┐ │
│  │  📅 10天速成计划                      │ │
│  │  ━━━━━━━━━━░░░░░░░░░░ 30%            │ │
│  │  第 3 天 / 共 10 天                   │ │
│  │  已学 900 / 总计 3,000 词             │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  今日任务（第3天）                           │
│  ┌───────────────────────────────────────┐ │
│  │  • 新词：300个  (预计40分钟)           │ │
│  │  • 复习：20个  (昨日停留最长)          │ │
│  │  • 总曝光：3,100次                     │ │
│  │                                       │ │
│  │  [开始今日学习]                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  学习数据                                    │
│  ┌─────────────────────────────────┐       │
│  │  昨日完成：3,050次  45分钟       │       │
│  │  平均停留：3.8秒 ✅              │       │
│  │  掌握率：88% (264/300词)        │       │
│  └─────────────────────────────────┘       │
│                                             │
│  最近学习记录                                │
│  ┌─────────────────────────────────┐       │
│  │  Day 2:  300词  3,050次  45分钟  │       │
│  │  Day 1:  300词  3,000次  42分钟  │       │
│  └─────────────────────────────────┘       │
│                                             │
│  [调整计划]  [查看详细统计]                 │
└─────────────────────────────────────────────┘
```

### 学习计划模板选择
```
┌─────────────────────────────────────────────┐
│  选择学习计划                                │
├─────────────────────────────────────────────┤
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  🚀 极速突击（7天）                    │ │
│  │  适合：考前冲刺                        │ │
│  │  每天：430新词 + 600次曝光            │ │
│  │  时长：每天60-70分钟                  │ │
│  │  强度：★★★★★                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  ⚡ 快速冲刺（10天）✅ 推荐           │ │
│  │  适合：短期备考                        │ │
│  │  每天：300新词 + 500次曝光            │ │
│  │  时长：每天40-50分钟                  │ │
│  │  强度：★★★★☆                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  📚 稳健学习（20天）                  │ │
│  │  适合：扎实记忆                        │ │
│  │  每天：150新词 + 400次曝光            │ │
│  │  时长：每天30-40分钟                  │ │
│  │  强度：★★★☆☆                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  ┌───────────────────────────────────────┐ │
│  │  🎯 长期规划（60天）                  │ │
│  │  适合：从容备考                        │ │
│  │  每天：92新词 + 350次曝光             │ │
│  │  时长：每天25-35分钟                  │ │
│  │  强度：★★☆☆☆                        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  [自定义计划]                               │
└─────────────────────────────────────────────┘
```

### 添加自定义词库
```
┌─────────────────────────────────────────────┐
│  ← 返回    添加词库                         │
├─────────────────────────────────────────────┤
│                                             │
│  词库名称                                    │
│  ┌───────────────────────────────────────┐ │
│  │  我的专业词汇                          │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  导入方式                                    │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  📥 文件导入     │  │  ✏️ 手动添加    │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  支持格式：                                  │
│  • Excel (.xlsx, .xls)                     │
│  • CSV (.csv)                              │
│  • 文本文件 (.txt)                          │
│                                             │
│  文件格式示例：                              │
│  ┌───────────────────────────────────────┐ │
│  │  单词,音标,释义,例句                   │ │
│  │  abandon,/əˈbændən/,放弃,He...        │ │
│  │  ability,/əˈbɪləti/,能力,She...       │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  [选择文件]                                 │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 📊 Tab 3: 统计页（墨墨式）

### 设计原则
- **借鉴墨墨的数据可视化**：清晰的图表、详细的统计、有用的洞察
- **分层展示**：主摘要 + 详细分析
- **可操作的数据**：不只是展示，还要给出建议

### 页面布局
```
┌─────────────────────────────────────────────┐
│  📊 学习统计                   本周 ▼       │  ← 导航栏 + 时间筛选
├─────────────────────────────────────────────┤
│                                             │
│  今日学习                                    │
│  ┌───────────────────────────────────────┐ │
│  │  🎯 已完成 220 / 400                  │ │
│  │  ⏱️ 学习时长: 38分25秒                │ │
│  │  ✅ 右滑（熟悉）: 145次               │ │
│  │  ❌ 左滑（困难）: 75次                │ │
│  │                                       │ │
│  │  [继续学习]                           │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  本周趋势                                    │
│  ┌───────────────────────────────────────┐ │
│  │     学习曲线                          │ │
│  │  400┤           ●                    │ │
│  │  300┤      ●    │   ●               │ │
│  │  200┤  ●   │    │   │   ●           │ │
│  │  100┤  │   │    │   │   │   ●   ●  │ │
│  │    └──┴───┴────┴───┴───┴───┴───┴──  │ │
│  │     一  二  三  四  五  六  日        │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  学习效率                                    │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  Flow率         │  │  平均停留        │  │
│  │  65%           │  │  3.2秒          │  │
│  │  ━━━━━━━━░░     │  │  🎯 理想范围    │  │
│  │  👍 很好        │  │                 │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  困难词汇 Top 10（按停留时间排序）⭐          │
│  ┌───────────────────────────────────────┐ │
│  │  1. abandonment   ←3  停留12.5s  ⚠️  │ │
│  │  2. resilient     ←2  停留9.8s   ⚠️  │ │
│  │  3. elaborate     ←2  停留8.3s   ⚠️  │ │
│  │  4. deteriorate   ←1  停留7.1s       │ │
│  │  5. catastrophe   →1  停留6.9s       │ │
│  │  ...                                  │ │
│  │  [查看全部]  [生成AI短文]             │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  学习建议                                    │
│  ┌───────────────────────────────────────┐ │
│  │  💡 建议                              │ │
│  │  • 上午学习效率最高，建议安排新词      │ │
│  │  • 名词类单词掌握较弱，可加强复习      │ │
│  │  • 本周进度良好，继续保持！            │ │
│  └───────────────────────────────────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

### 详细统计页（点击图表进入）
```
┌─────────────────────────────────────────────┐
│  ← 返回    学习详情                         │
├─────────────────────────────────────────────┤
│                                             │
│  [今天] [本周] [本月] [全部]                │  ← Tab切换
│                                             │
│  效率曲线（每小时）                          │
│  ┌───────────────────────────────────────┐ │
│  │  曝光数                               │ │
│  │   60┤     ●●●                        │ │
│  │   40┤  ●●│││●●                       │ │
│  │   20┤ ●│││││││●                      │ │
│  │    └────────────                     │ │
│  │     9 10 11 12 13 14 15 16 (时)      │ │
│  │                                       │ │
│  │  最佳时段: 10:00-12:00               │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  节奏指数                                    │
│  ┌─────────────────────────────────────┐   │
│  │  Flow (前5秒右滑率)                  │   │
│  │  ━━━━━━━━━━━━━━░░ 65%              │   │
│  │  目标: >60%  ✅ 达标                 │   │
│  │                                     │   │
│  │  Friction (>8秒左滑率)              │   │
│  │  ━━━░░░░░░░░░░░░ 15%              │   │
│  │  目标: <20%  ✅ 达标                 │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  困难词簇分析                                │
│  ┌─────────────────────────────────────┐   │
│  │  按词性                              │   │
│  │  名词:   ■■■■■■░░ 45% (困难)       │   │
│  │  动词:   ■■■░░░░░ 25%             │   │
│  │  形容词: ■■░░░░░░ 20%             │   │
│  │  副词:   ■░░░░░░░ 10%             │   │
│  │                                     │   │
│  │  按词频                              │   │
│  │  高频词: ■■░░░░░░ 20%             │   │
│  │  中频词: ■■■■■░░░ 40%            │   │
│  │  低频词: ■■■■■■░░ 50% (困难)     │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  L1使用率趋势                                │
│  ┌─────────────────────────────────────┐   │
│  │  点按显示中文次数                    │   │
│  │   50┤●                              │   │
│  │   40┤ ●                             │   │
│  │   30┤  ●                            │   │
│  │   20┤   ●                           │   │
│  │   10┤    ●                          │   │
│  │    └─────────                       │   │
│  │     W1 W2 W3 W4 W5                  │   │
│  │                                     │   │
│  │  📉 下降50%  继续保持！             │   │
│  └─────────────────────────────────────┘   │
│                                             │
└─────────────────────────────────────────────┘
```

---

## 👤 Tab 4: 我的页（墨墨式）

### 设计原则
- **借鉴墨墨的个人中心**：简洁的资料展示、清晰的功能入口、成就激励
- **功能聚合**：将所有设置和个人信息集中管理
- **成就系统**：激励用户持续学习

### 页面布局
```
┌─────────────────────────────────────────────┐
│  👤 我的                         ⚙️ 设置    │  ← 导航栏
├─────────────────────────────────────────────┤
│                                             │
│  个人信息卡片                                │
│  ┌───────────────────────────────────────┐ │
│  │  👤 学习者昵称                        │ │
│  │  📅 学习 67 天  |  🔥 连续签到 23天   │ │
│  │                                       │ │
│  │  本周学习: 1,280词  |  累计: 8,640词  │ │
│  │                                       │ │
│  │  等级: Lv.12 进阶学习者               │ │
│  │  ━━━━━━━━━━░░░░ 75%                  │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  学习数据                                    │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  📚 词汇量       │  │  📊 学习时长     │  │
│  │  8,640词        │  │  126小时        │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  ┌─────────────────┐  ┌─────────────────┐  │
│  │  🎯 完成率       │  │  🔥 最长连续     │  │
│  │  87%           │  │  45天           │  │
│  └─────────────────┘  └─────────────────┘  │
│                                             │
│  成就徽章                                    │
│  ┌───────────────────────────────────────┐ │
│  │  🏆 [初学者] [坚持者] [单词达人]      │ │
│  │  [查看全部成就 →]                     │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  功能菜单                                    │
│  ┌───────────────────────────────────────┐ │
│  │  📚 我的词库                   →      │ │
│  │  📊 学习统计                   →      │ │
│  │  ⭐ 生词本                     →      │ │
│  │  📝 学习历史                   →      │ │
│  │  🎯 学习计划                   →      │ │
│  │  ⚙️ 设置                       →      │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  其他                                        │
│  ┌───────────────────────────────────────┐ │
│  │  💡 帮助与反馈                 →      │ │
│  │  ℹ️ 关于NFwords                →      │ │
│  └───────────────────────────────────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

### 设置页（墨墨式）
```
┌─────────────────────────────────────────────┐
│  ← 返回    设置                             │
├─────────────────────────────────────────────┤
│                                             │
│  学习设置                                    │
│  ┌───────────────────────────────────────┐ │
│  │  🔊 自动发音              [开] ──○    │ │
│  │                                       │ │
│  │  🌐 L1渐隐强度                        │ │
│  │     温和 · 标准 · 激进                │ │
│  │           ──●──                       │ │
│  │                                       │ │
│  │  🤖 AI微场景              [开] ──○    │ │
│  │     (失败自动回退本地模板)            │ │
│  │                                       │ │
│  │  📅 每日目标                          │ │
│  │     新词: [50] 个/天                  │ │
│  │     曝光: [400] 次/天                 │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  提醒设置                                    │
│  ┌───────────────────────────────────────┐ │
│  │  ⏰ 学习提醒              [开] ──○    │ │
│  │     每天 09:00                        │ │
│  │                                       │ │
│  │  🔔 进度提醒              [开] ──○    │ │
│  │     完成每日目标时通知                │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  显示设置                                    │
│  ┌───────────────────────────────────────┐ │
│  │  🌓 深色模式              [跟随系统]  │ │
│  │                                       │ │
│  │  📱 触感反馈              [开] ──○    │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  数据管理                                    │
│  ┌───────────────────────────────────────┐ │
│  │  ☁️ iCloud同步            [开] ──○    │ │
│  │     最后同步: 2分钟前                 │ │
│  │                                       │ │
│  │  📤 导出学习数据           →          │ │
│  │  🗑️ 清除缓存               →          │ │
│  └───────────────────────────────────────┘ │
│                                             │
│  隐私                                        │
│  ┌───────────────────────────────────────┐ │
│  │  📊 改进体验数据          [关] ○──    │ │
│  │     匿名统计，帮助改进产品            │ │
│  │                                       │ │
│  │  🔒 隐私政策               →          │ │
│  └───────────────────────────────────────┘ │
│                                             │
└─────────────────────────────────────────────┘
```

---

### 1.4 导航流程图

```
启动应用
    │
    ↓
  首页
    │
    ├─→ [学习] Tab ──→ Tinder式卡片学习
    │                    │
    │                    ├─→ 点击卡片 → 翻转查看释义
    │                    ├─→ 左滑/右滑 → 下一张卡片
    │                    ├─→ 点击发音 → 播放单词
    │                    └─→ 完成 → 学习报告 → 返回/继续
    │
    ├─→ [词库] Tab ──→ 墨墨式词库管理
    │                    │
    │                    ├─→ 当前词库卡片 → 查看详情
    │                    │                  │
    │                    │                  ├─→ 开始学习 → 跳转学习Tab
    │                    │                  └─→ 调整计划
    │                    │
    │                    ├─→ 推荐词库 → 选择 → 开始学习
    │                    └─→ 添加词库 → 导入/创建
    │
    ├─→ [统计] Tab ──→ 墨墨式数据分析
    │                    │
    │                    ├─→ 今日学习 → 继续学习
    │                    ├─→ 本周趋势 → 查看详情
    │                    ├─→ 困难词汇 → 专项练习
    │                    └─→ 学习建议
    │
    └─→ [我的] Tab ──→ 墨墨式个人中心
                         │
                         ├─→ 个人信息
                         ├─→ 成就徽章
                         ├─→ 功能菜单
                         │   ├─→ 我的词库
                         │   ├─→ 学习统计
                         │   ├─→ 生词本
                         │   ├─→ 学习历史
                         │   ├─→ 学习计划
                         │   └─→ 设置
                         └─→ 帮助与反馈
```

---

### 1.5 设计风格对照表

| 界面/功能 | 设计风格 | 核心元素 | 参考应用 |
|----------|---------|---------|---------|
| **学习卡片界面** | Tinder式 | 卡片堆叠、左右滑动、旋转动画、方向提示 | Tinder |
| **词库选择页** | 墨墨式 | 卡片布局、进度条、详细信息、一键开始 | 墨墨背单词 |
| **学习计划页** | 墨墨式 | 目标设定、进度跟踪、计划调整 | 墨墨背单词 |
| **统计分析页** | 墨墨式 | 数据可视化、趋势图表、详细洞察 | 墨墨背单词 |
| **个人中心页** | 墨墨式 | 个人资料、成就系统、功能入口 | 墨墨背单词 |
| **设置页** | 墨墨式 | 分组设置、开关控制、清晰说明 | 墨墨背单词 |

---

### 1.6 关键交互原则

#### Tinder式交互（仅用于学习页）
1. **极简主义**：卡片只显示必要信息
2. **手势优先**：左右滑动是核心交互
3. **即时反馈**：每个操作都有明确的视觉和触觉反馈
4. **零思考**：不需要点击按钮，滑动即决策

#### 墨墨式界面（用于其他页面）
1. **信息丰富**：提供详细的数据和统计
2. **结构清晰**：使用卡片和分组组织内容
3. **功能完善**：提供多种管理和分析工具
4. **科学规划**：帮助用户制定和跟踪学习计划

---

## 二、MVP核心共识

### 1.1 设计原则

| 原则 | 说明 | 实现方式 |
|------|------|----------|
| **无刻度、无段位** | 前台不显示复杂的等级系统 | 只显示"今日曝光进度"和"剩余出现次数" |
| **学习即刷卡** | 打开应用直接进入学习 | 无模式切换，无复杂开关 |
| **思维化沉浸** | 逐步淡化母语依赖 | L1→L2渐隐规则自动调整内容呈现 |
| **复现优先** | 基于连续量智能调度 | 使用`remainingExposures`和`difficulty`（内部使用） |
| **复盘全面但分层** | 提供专业统计但不干扰 | 主摘要简洁，二级页面深度洞察 |

### 1.2 可感知进度（仅两类）

#### 顶部进度条
```
今日完成曝光 / 今日预算
例：220 / 400
```

#### 卡片角标
```
剩余出现次数
例：剩 3 次
```

---

## 三、Tinder式学习卡片交互

### 3.1 核心概念（纯Tinder式）

**设计灵感：**
- **完全借鉴Tinder**：极简卡片堆叠、流畅的左右滑动手势、明确的方向指示
- **零干扰设计**：学习页面没有复杂的翻转、没有长篇内容，只有快速滑动

**核心交互：**
- **卡片堆叠**：3张卡片层叠展示，形成空间纵深感
- **左右滑动**：快速判断熟悉度（右滑=认识，左滑=不认识）
- **点击展开**：轻点卡片查看简要释义和例句（不翻转，内嵌显示）
- **上下滑动**：卡片内容区域可上下滚动查看更多信息

### 3.2 交互流程

#### 第一步：卡片堆叠展示（Tinder式）
```
┌─────────────────────────┐
│                         │  ← 后方卡片3（缩小+偏移）
│  ┌─────────────────────┐│
│  │                     ││  ← 后方卡片2（缩小+偏移）
│  │ ┌─────────────────┐ ││
│  │ │                 │ ││
│  │ │  abandonment    │ ││  ← 当前卡片（最大）
│  │ │  /əˈbændənmənt/ │ ││
│  │ │                 │ ││
│  │ │    剩 3 次       │ ││
│  │ │                 │ ││
│  │ └─────────────────┘ ││
│  └─────────────────────┘│
└─────────────────────────┘
```
- **卡片堆叠**：最多显示3张卡片，后面的卡片逐渐缩小并偏移
- **默认状态**：只显示单词、音标和剩余次数
- **左右滑动提示**：轻微拖动时显示绿色（右）/橙色（左）背景

#### 第二步：点击展开查看释义
```
┌─────────────────────────┐
│     abandonment         │
│     /əˈbændənmənt/      │
│         剩 3 次          │
│  ───────────────────    │  ← 内容分隔线
│  [释义]                 │  ← 点击后展开
│  n. 放弃，遗弃          │
│                         │
│  [短语]                 │
│  abandonment of duty    │
│  放弃责任                │
│                         │
│  ↓ 向下滚动查看更多      │
└─────────────────────────┘
```
- **点击卡片**：内容区域平滑展开（不翻转）
- **可滚动内容**：上下滑动查看例句和微场景
- **再次点击**：收起内容，回到极简状态

#### 第三步：水平滑动做出选择（Tinder式）

##### 右滑 → 认识/熟悉
```
    卡片向右飞出 →→→
    背景显示绿色 ✓
    触感：轻震动
```

##### 左滑 → 不认识/困难
```
←←← 卡片向左飞出
    背景显示橙色 ✗
    触感：中等震动
```

#### 第四步：滚动查看更多内容
```
┌─────────────────────────┐
│  [例句/场景]             │
│                         │
│  You stand on the beach,│
│  the concept of         │
│  abandonment slowly     │
│  settling in your mind. │
│                         │
│  [点击查看中文]          │
│                         │
└─────────────────────────┘
```
- **垂直滚动**：在展开的内容区域内上下滚动
- **查看例句**：显示实际使用场景
- **微场景**：困难单词会显示沉浸式场景

### 3.3 交互特性

#### ✨ 流畅性保证（对标Tinder 60fps）
- **60 FPS 滑动**：使用高性能动画引擎
- **弹性动画**：`spring(response: 0.35, dampingFraction: 0.75)`
- **卡片预加载**：预加载前3张卡片内容
- **快速响应**：滑动手势零延迟响应

#### 🎨 视觉反馈（借鉴Tinder）
- **滑动方向提示**：
  - 右滑时卡片右上角显示绿色 ✓ 图标
  - 左滑时卡片左上角显示橙色 ✗ 图标
  - 滑动距离越大，图标越明显
- **卡片旋转**：跟随滑动方向轻微旋转（±15°）
- **背景渐变**：滑动时背景色渐变提示方向
- **卡片堆叠**：后方卡片按比例缩放和偏移

#### 🔄 手势系统（纯Tinder式）
| 手势 | 作用 | 反馈 |
|------|------|------|
| **点击卡片** | 展开/收起内容区 | 平滑展开动画 |
| **水平滑动** | 右滑=认识；左滑=不认识 | 方向图标 + 旋转 + 飞出 |
| **垂直滑动（内容区）** | 滚动查看更多内容 | 平滑滚动 |
| **长按单词** | 播放发音 | 波纹动画 + 震动 |
| **双击** | 快速右滑（认识） | 直接飞出 |

---

## 四、墨墨式界面设计

### 4.1 设计总结

墨墨式界面应用于**词库、统计、个人中心**等管理和分析页面，特点如下：

### 4.2 核心设计元素

#### 📚 词库管理（借鉴墨墨）
- **卡片式展示**：每个词库用一张卡片展示关键信息
- **进度可视化**：清晰的进度条显示学习进度
- **详细信息**：词量、今日计划、学习历史一目了然
- **一键操作**：继续学习、查看详情、调整计划

#### 📊 数据统计（借鉴墨墨）
- **分层展示**：主摘要 + 详细分析
- **图表可视化**：曲线图、柱状图、趋势图
- **智能洞察**：Flow率、Friction率、困难词簇
- **可操作建议**：基于数据给出学习建议

#### 👤 个人中心（借鉴墨墨）
- **个人信息卡片**：学习天数、连续签到、等级进度
- **成就系统**：徽章激励持续学习
- **功能聚合**：所有设置和功能的统一入口
- **数据展示**：词汇量、学习时长、完成率等

#### ⚙️ 设置页面（借鉴墨墨）
- **分组管理**：学习设置、提醒设置、显示设置等
- **开关控制**：清晰的Toggle控件
- **详细说明**：每个选项都有解释说明
- **数据管理**：iCloud同步、导出、清除缓存

### 4.3 设计规范

#### 布局规范
```swift
// 卡片边距
.padding(.horizontal, 16)
.padding(.vertical, 12)

// 卡片圆角
.cornerRadius(12)

// 卡片阴影
.shadow(color: .black.opacity(0.05), radius: 8, y: 2)

// 分组标题
Text("学习设置")
    .font(.headline)
    .foregroundColor(.secondary)
    .padding(.leading, 16)
    .padding(.top, 24)
```

#### 颜色规范
```swift
// 主要文字
Color.primary

// 次要文字
Color.secondary

// 进度条
Color.blue  // 已完成部分
Color.gray.opacity(0.2)  // 未完成部分

// 强调色
Color.green  // 正向反馈
Color.orange // 警告
Color.red    // 错误
```

#### 组件规范
```swift
// 统计卡片
VStack(spacing: 8) {
    Text("8,640")
        .font(.title.bold())
    Text("词汇量")
        .font(.caption)
        .foregroundColor(.secondary)
}
.frame(maxWidth: .infinity)
.padding()
.background(Color.white)
.cornerRadius(12)
.shadow(color: .black.opacity(0.05), radius: 8)

// 进度条
ProgressView(value: 0.72)
    .tint(.blue)
    .scaleEffect(y: 2)

// 列表项
HStack {
    Text("📚 我的词库")
    Spacer()
    Image(systemName: "chevron.right")
        .foregroundColor(.secondary)
}
.padding()
.background(Color.white)
.cornerRadius(8)
```

### 4.4 与Tinder式的对比

| 维度 | Tinder式（学习页） | 墨墨式（管理页） |
|-----|-------------------|-----------------|
| **信息密度** | 极简（单词+音标） | 丰富（多层级信息） |
| **交互方式** | 手势主导 | 点击主导 |
| **视觉风格** | 大面积留白 | 信息卡片堆叠 |
| **动画** | 快速弹性动画 | 平滑过渡动画 |
| **目标** | 快速决策 | 详细管理与分析 |

---

## 五、停留时间追踪系统

### 5.1 核心理念

**停留时间 = 熟悉度**

与传统的"左滑/右滑"判断不同，NFwords 通过**精确记录每个单词的停留时间**来科学评估用户对单词的熟悉程度：
- ⏱️ **停留时间越长** = 越不熟悉 = 需要更多复习
- ⚡ **停留时间越短** = 越熟悉 = 可以减少出现频率

这种方式更加**客观、准确**，避免了用户自我评估的主观偏差。

### 5.2 实现机制

#### 记录时机

```swift
class CardDwellTracker: ObservableObject {
    @Published var startTime: Date = Date()
    @Published var currentWordId: Int = 0
    
    // 1. 卡片出现时开始计时
    func onCardAppear(wordId: Int) {
        startTime = Date()
        currentWordId = wordId
        print("📱 单词 \(wordId) 开始计时")
    }
    
    // 2. 卡片消失时记录
    func onCardDisappear() {
        let dwellTime = Date().timeIntervalSince(startTime)
        recordDwellTime(wordId: currentWordId, duration: dwellTime)
        print("⏱️ 单词 \(currentWordId) 停留 \(String(format: "%.2f", dwellTime))秒")
    }
    
    // 3. 滑动时也记录
    func onSwipe(direction: SwipeDirection) {
        let dwellTime = Date().timeIntervalSince(startTime)
        recordSwipe(
            wordId: currentWordId,
            direction: direction,
            dwellTime: dwellTime
        )
        print("👉 单词 \(currentWordId) \(direction.rawValue)滑动，停留 \(String(format: "%.2f", dwellTime))秒")
    }
    
    // 4. 点击展开内容时记录
    func onContentExpand() {
        let partialDwell = Date().timeIntervalSince(startTime)
        print("👆 单词 \(currentWordId) 在 \(String(format: "%.2f", partialDwell))秒后展开内容")
    }
}
```

#### 记录内容

```swift
struct DwellTimeRecord: Codable {
    let wordId: Int
    let timestamp: Date
    let duration: TimeInterval      // 停留时长（秒）
    let swipeDirection: String?     // "right" / "left" / nil
    let didExpandContent: Bool      // 是否展开查看释义
    let sessionId: String           // 本次学习会话ID
}
```

### 5.3 每日停留时间排行榜

#### 生成时机
每次学习完成后，自动生成**停留时间排序表**：

```
┌───────────────────────────────────────────┐
│  📊 今日困难词汇（按停留时间排序）         │
├───────────────────────────────────────────┤
│  1. abandonment      停留 12.5秒  左滑3次 │
│  2. resilient        停留 9.8秒   左滑2次 │
│  3. elaborate        停留 8.3秒   左滑2次 │
│  4. deteriorate      停留 7.1秒   左滑1次 │
│  5. catastrophe      停留 6.9秒   右滑1次 │
│  ...                                      │
│  20. accomplish      停留 2.1秒   右滑5次 │
├───────────────────────────────────────────┤
│  💡 前10个单词平均停留 8.5秒              │
│     建议重点复习这些单词                  │
│                                           │
│  [生成AI阅读短文] [导出困难词列表]        │
└───────────────────────────────────────────┘
```

#### 排序逻辑

```swift
func generateDifficultyRanking() -> [WordDifficulty] {
    let todayRecords = dwellTimeRecords.filter { 
        Calendar.current.isDateInToday($0.timestamp) 
    }
    
    // 按单词聚合
    let grouped = Dictionary(grouping: todayRecords) { $0.wordId }
    
    // 计算平均停留时间和左滑次数
    let rankings = grouped.map { (wordId, records) in
        let avgDwell = records.map { $0.duration }.reduce(0, +) / Double(records.count)
        let leftSwipes = records.filter { $0.swipeDirection == "left" }.count
        let totalAppearances = records.count
        
        return WordDifficulty(
            wordId: wordId,
            avgDwellTime: avgDwell,
            leftSwipeCount: leftSwipes,
            totalAppearances: totalAppearances,
            difficultyScore: avgDwell * 10 + Double(leftSwipes) * 5
        )
    }
    
    // 按难度分数排序（停留时间权重更高）
    return rankings.sorted { $0.difficultyScore > $1.difficultyScore }
}
```

### 5.4 停留时间阈值

| 停留时间 | 熟悉程度 | 调度策略 |
|---------|---------|---------|
| **0-2秒** | 非常熟悉 | 降低出现频率，可能不再出现 |
| **2-5秒** | 基本熟悉 | 保持正常频率 |
| **5-8秒** | 不够熟悉 | 增加出现频率 |
| **>8秒** | 非常陌生 | 高频出现 + 生成AI短文 |

### 5.5 与左右滑动的结合

停留时间作为**主要指标**，左右滑动作为**辅助参考**：

```swift
func calculateWordDifficulty(record: WordLearningRecord) -> Double {
    let dwellWeight = 0.7   // 停留时间权重70%
    let swipeWeight = 0.3   // 滑动方向权重30%
    
    let dwellScore = min(record.avgDwellTime / 10.0, 1.0)  // 归一化到0-1
    let swipeScore = Double(record.leftSwipeCount) / Double(record.totalSwipes)
    
    return dwellScore * dwellWeight + swipeScore * swipeWeight
}
```

### 5.6 可视化展示

#### 学习过程中
```
当前单词：abandonment
停留时间：5.2秒 ⏱️
提示：需要加强记忆
```

#### 复盘页面
```
停留时间分布：

 >10s  ■■■■░░░░░░ 15% (极度困难)
 8-10s ■■■■■░░░░░ 20% (困难)
 5-8s  ■■■■■■■░░░ 30% (不够熟悉)
 2-5s  ■■■■■■■■░░ 35% (基本熟悉)
 <2s   ■■■■■■■■■■ 10% (非常熟悉)
```

---

## 六、学习计划与任务调度

### 6.1 核心理念

**任务预定制 + 算法智能调度**

用户只需设定**目标**（如"10天背3000词"），系统自动计算并安排每天的学习任务，无需每天纠结该学什么。

### 6.2 学习计划设置

#### 创建计划
```
┌───────────────────────────────────────────┐
│  📅 创建学习计划                          │
├───────────────────────────────────────────┤
│                                           │
│  选择词库：                               │
│  ✓ 考研核心词汇 (5,500词)                 │
│                                           │
│  学习周期：                               │
│  [ 10 ] 天                                │
│                                           │
│  ────────────────────────────────         │
│                                           │
│  📊 自动计算结果：                         │
│                                           │
│  • 每天新词：550 词                       │
│  • 每天复习：约 200-300 次曝光            │
│  • 预计时长：每天 40-60 分钟              │
│  • 每个单词：预计出现 5-8 次              │
│                                           │
│  ────────────────────────────────         │
│                                           │
│  开始日期：2025-11-04                     │
│  结束日期：2025-11-14                     │
│                                           │
│  [确认创建]  [调整参数]                   │
└───────────────────────────────────────────┘
```

#### 典型计划模板

| 计划名称 | 词汇量 | 周期 | 每日新词 | 每日曝光 | 适合人群 |
|---------|-------|------|---------|---------|---------|
| **极速突击** | 3000词 | 7天 | 430词 | 600次 | 考前冲刺 |
| **快速冲刺** | 3000词 | 10天 | 300词 | 500次 | 短期备考 |
| **稳健学习** | 3000词 | 20天 | 150词 | 400次 | 扎实记忆 |
| **长期规划** | 5500词 | 60天 | 92词 | 350次 | 从容备考 |

### 6.3 每日任务生成算法

#### 算法原理

**量变引起质变** - 摒弃艾宾浩斯曲线，采用**高频重复**策略：

```swift
class TaskScheduler {
    // 生成每日任务
    func generateDailyTask(plan: StudyPlan, day: Int) -> DailyTask {
        let totalDays = plan.durationDays
        let totalWords = plan.totalWords
        
        // 1. 计算今天的新词
        let newWordsToday = calculateNewWords(day: day, plan: plan)
        
        // 2. 计算需要复习的词（前几天学过的）
        let reviewWords = calculateReviewWords(day: day, plan: plan)
        
        // 3. 合并并打乱顺序
        var todayQueue = newWordsToday + reviewWords
        todayQueue = shuffleWithSpacing(todayQueue)
        
        // 4. 设置每个词的出现次数（基于停留时间）
        todayQueue = assignRepetitions(todayQueue)
        
        return DailyTask(
            day: day,
            newWords: newWordsToday.count,
            reviewWords: reviewWords.count,
            totalExposures: todayQueue.reduce(0) { $0 + $1.repetitions },
            queue: todayQueue
        )
    }
    
    // 计算新词数量（前期多，后期少）
    func calculateNewWords(day: Int, plan: StudyPlan) -> [Word] {
        let totalWords = plan.totalWords
        let totalDays = plan.durationDays
        
        // 前70%的天数学习90%的词汇
        let frontLoadRatio = 0.7
        
        if day <= Int(Double(totalDays) * frontLoadRatio) {
            // 前期：每天多学新词
            let wordsPerDay = Int(Double(totalWords) * 0.9 / (Double(totalDays) * frontLoadRatio))
            return getNewWords(count: wordsPerDay, day: day)
        } else {
            // 后期：主要复习，少量新词
            let wordsPerDay = Int(Double(totalWords) * 0.1 / (Double(totalDays) * (1 - frontLoadRatio)))
            return getNewWords(count: wordsPerDay, day: day)
        }
    }
    
    // 计算复习词（昨天学的必复习，前天的按停留时间决定）
    func calculateReviewWords(day: Int, plan: StudyPlan) -> [Word] {
        var reviewList: [Word] = []
        
        // 昨天的词：全部复习
        if day > 1 {
            let yesterdayWords = getWordsLearnedOnDay(day - 1)
            reviewList.append(contentsOf: yesterdayWords)
        }
        
        // 前几天的词：按停留时间和左滑次数决定
        for pastDay in max(1, day - 5)..<(day - 1) {
            let pastWords = getWordsLearnedOnDay(pastDay)
            let difficultWords = pastWords.filter { word in
                let record = getDwellTimeRecord(wordId: word.id)
                return record.avgDwellTime > 5.0 || record.leftSwipeCount > 2
            }
            reviewList.append(contentsOf: difficultWords)
        }
        
        return reviewList
    }
    
    // 分配每个词今天出现的次数
    func assignRepetitions(_ words: [Word]) -> [WordWithRepetitions] {
        return words.map { word in
            let record = getDwellTimeRecord(wordId: word.id)
            
            // 根据停留时间决定重复次数
            var repetitions: Int
            if record.avgDwellTime > 8.0 {
                repetitions = 8  // 极度困难：8次
            } else if record.avgDwellTime > 5.0 {
                repetitions = 6  // 困难：6次
            } else if record.avgDwellTime > 2.0 {
                repetitions = 4  // 一般：4次
            } else if record.isNewWord {
                repetitions = 5  // 新词：5次
            } else {
                repetitions = 2  // 简单：2次
            }
            
            return WordWithRepetitions(word: word, repetitions: repetitions)
        }
    }
}
```

### 6.4 每日任务展示

```
┌───────────────────────────────────────────┐
│  📅 第 3 天 / 共 10 天                     │
├───────────────────────────────────────────┤
│                                           │
│  今日任务：                               │
│  • 新词：300 个                           │
│  • 复习：昨日 300 词 + 困难 50 词         │
│  • 总曝光：约 450 次                      │
│  • 预计时长：45 分钟                      │
│                                           │
│  ━━━━━━━━━━░░░░░░░░░░ 30%               │
│  完成进度：0 / 450                        │
│                                           │
│  [开始今日学习]                           │
│                                           │
│  ────────────────────────────────         │
│                                           │
│  📊 计划进度：                             │
│  已学单词：900 / 3,000 (30%)             │
│  剩余天数：7 天                           │
│  进度状态：✅ 正常                        │
│                                           │
│  [调整计划]  [查看详情]                   │
└───────────────────────────────────────────┘
```

### 6.5 动态调整

#### 自动调整触发条件

1. **进度落后**：当天未完成任务 → 次日适当增加曝光次数
2. **进度超前**：连续3天提前完成 → 次日可减少曝光次数
3. **困难词过多**：停留>8秒的词超过30% → 减少新词，增加复习

```swift
func adjustPlanIfNeeded(currentDay: Int, plan: StudyPlan) -> StudyPlan {
    let completion = getCompletionRate(day: currentDay)
    let avgDwellTime = getAvgDwellTime(day: currentDay)
    
    var adjustedPlan = plan
    
    // 进度落后：增加每日曝光
    if completion < 0.7 {
        adjustedPlan.dailyExposureTarget += 50
        print("⚠️ 进度落后，增加每日曝光 +50")
    }
    
    // 困难词过多：减少新词
    if avgDwellTime > 6.0 {
        adjustedPlan.dailyNewWords -= 50
        print("⚠️ 困难词过多，减少新词 -50")
    }
    
    // 进度超前：可选择保持或减少
    if completion > 1.2 {
        adjustedPlan.dailyExposureTarget -= 30
        print("✅ 进度超前，减少压力 -30")
    }
    
    return adjustedPlan
}
```

### 6.6 与传统方法对比

| 维度 | 传统方法（艾宾浩斯） | NFwords（量变引起质变） |
|------|-------------------|----------------------|
| **复习时机** | 固定间隔（1天、2天、4天...） | 基于停留时间动态调整 |
| **出现次数** | 受限于记忆曲线 | 高频重复，次数不封顶 |
| **任务规划** | 每天不确定 | 提前10天全部规划好 |
| **适用场景** | 长期记忆保持 | 短期应试突击（2-6月） |
| **心理压力** | 需要每天决策 | 无需思考，跟着走即可 |

### 6.7 计划完成后

```
┌───────────────────────────────────────────┐
│  🎉 计划完成！                            │
├───────────────────────────────────────────┤
│                                           │
│  10天学习之旅圆满结束                      │
│                                           │
│  📊 学习成果：                             │
│  • 学完单词：3,000 词                     │
│  • 总曝光次数：4,850 次                   │
│  • 总学习时长：8小时 45分钟               │
│  • 平均停留时间：4.2 秒 ✅                │
│                                           │
│  🏆 掌握程度分析：                         │
│  • 熟练掌握 (<3秒)：1,800 词 (60%)       │
│  • 基本掌握 (3-6秒)：900 词 (30%)        │
│  • 需要加强 (>6秒)：300 词 (10%)         │
│                                           │
│  💡 建议：                                │
│  针对300个困难词汇，已为您生成            │
│  10篇考研风格阅读短文，继续巩固！         │
│                                           │
│  [查看困难词列表]  [生成AI短文]           │
│  [导出单词本]      [创建新计划]           │
└───────────────────────────────────────────┘
```

---

## 七、L1→L2渐隐规则

### 5.1 设计目标

通过**逐步减少母语（L1）展示**，转向**目标语言（L2）释义、同义词、搭配、微场景**，实现思维化学习，帮助用户建立"英语思维"。

### 5.2 渐隐策略表

| 条件（任一满足） | 内容展示策略 | L1可见性 |
|-----------------|-------------|---------|
| **第1次曝光** / `exposures ≤ 1` | • 1-2条中文短释义<br>• 1条短语（中英对照） | ✅ 完全可见 |
| **第2-3次曝光** 且最近右滑 | • 英文释义（L2简释）<br>• 短语（仅英文）<br>• 中文收起为"点按可见" | ⚠️ 半隐藏 |
| **≥4次曝光** 或 `remainingExposures ≤ 2` | • 仅英文释义<br>• 搭配/同义词<br>• 中文需点按显露 | ❌ 默认隐藏 |
| **困难态**（长停留+左滑） | • 临时放宽：恢复1条中文短释义<br>• 附加1条微场景句 | ✅ 暂时恢复 |

### 5.3 示例：单词 *abandonment* 的渐进展示

#### 🔹 第1次出现（刚学）
```yaml
正面: abandonment | 剩 10 次
反面:
  释义:
    - n. 放弃，遗弃
  短语:
    - abandonment of responsibility (放弃责任)
  微场景: [点击上滑查看]
```

#### 🔹 第2-3次出现（稍熟悉）
```yaml
正面: abandonment | 剩 7 次
反面:
  释义:
    - the act of leaving someone/something permanently
    - [点按显示中文: 放弃、弃置]
  短语:
    - abandonment of rights
  微场景: [上滑查看]
```

#### 🔹 第4次及以后（熟悉）
```yaml
正面: abandonment | 剩 3 次
反面:
  释义:
    - giving up completely; desertion
  搭配:
    - legal abandonment
    - emotional abandonment
  同义: desertion, forsaking
  微场景: The sudden abandonment of the project...
  [点按显示中文]
```

### 5.4 实现细节

#### 客户端本地决策
```swift
func determineContentLevel(for record: WordLearningRecord) -> ContentLevel {
    // 困难态：长停留 + 左滑
    if record.avgDwellTime > 8.0 && record.recentLeftSwipes >= 2 {
        return .withL1AndScene  // 放宽，显示中文+微场景
    }
    
    // 第1次
    if record.exposures <= 1 {
        return .fullL1  // 完整中文
    }
    
    // 第2-3次且最近右滑
    if record.exposures <= 3 && record.lastSwipeDirection == .right {
        return .partialL1  // 部分中文
    }
    
    // ≥4次或剩余≤2
    if record.exposures >= 4 || record.remainingExposures <= 2 {
        return .l2Only  // 纯英文
    }
    
    return .partialL1
}
```

---

## 六、氛围感设计

### 6.1 微场景（Micro-scene）

#### 触发条件
- 用户进入**困难态**（长停留 + 左滑）时
- 下一次出现该词时附加微场景

#### 内容要求
```yaml
长度: 80-120字母
人称: 第一/第二人称（You...）
语境: 沉浸式、情景化
示例: |
  You stand on the platform in absolute silence; 
  the announcement is barely audible.
```

#### 生成与缓存
- **优先级**：API生成 > 本地模板句
- **缓存策略**：同词同场景7天内不重复生成
- **失败回退**：API失败时使用本地模板库

### 6.2 发音与节奏

#### 播放策略
| 场景 | 行为 | 实现 |
|------|------|------|
| 点击单词 | 立即播放 | `AVSpeechSynthesizer` |
| 快速滑卡 | 不强制播放 | 用户可在设置开启"自动播放" |
| 长按单词 | 慢速重读 | `utterance.rate = 0.4` |

#### 触感反馈
```swift
// 右滑（熟悉）
UIImpactFeedbackGenerator(style: .light).impactOccurred()

// 左滑（困难）
UIImpactFeedbackGenerator(style: .medium).impactOccurred()

// 困难触发（带微场景）
UINotificationFeedbackGenerator().notificationOccurred(.warning)
```

---

## 七、智能调度系统

### 7.1 核心参数

#### 内部连续量（不对用户显示）

##### `difficulty` (0-1连续分值)
```swift
// 计算公式
difficulty = base
    + 0.35 * leftSwipes          // 左滑增加难度
    - 0.25 * rightSwipes         // 右滑降低难度
    + 0.15 * log1p(dwellTime)    // 停留时长
    - min(0.3, 0.02 * exposures) // 多次曝光衰减
    + frequencyBonus             // 词频先验 (0-0.1)

difficulty = clamp(difficulty, 0.0, 1.0)
```

##### `remainingExposures`（剩余出现次数）
- **右滑**：`-1`
- **左滑**：`+1`（下限为2）
- **清零**：该词今日不再出现

### 7.2 每日预算

#### 动态调整
```
初始预算: 400
之后预算: 300-800 自适应

计算公式:
nextDayBudget = 0.5 * yesterdayCompleted 
              + 0.5 * avg(recent3Days)

限制: clamp(nextDayBudget, 300, 800)
```

#### 预算分配
```
复现池 (已学词): 60-70%
新词: 30-40%
```

### 7.3 队列构建

#### 优先级规则
1. **高difficulty词**优先复现
2. **新词**首日至少2次曝光
3. **间距洗牌**：避免同词连续出现

#### 算法伪代码
```swift
func buildDailyQueue(budget: Int) -> [StudyCard] {
    // 1. 收集复现池（remainingExposures > 0）
    let reviewPool = getReviewWords()
        .sorted { $0.difficulty > $1.difficulty }
    
    // 2. 收集新词
    let newWords = getNewWords(limit: budget * 0.35)
    
    // 3. 合并
    var queue = reviewPool + newWords
    
    // 4. 间距洗牌（避免连续相同）
    queue = shuffleWithSpacing(queue, minGap: 3)
    
    // 5. 截断到预算
    return Array(queue.prefix(budget))
}
```

---

## 八、复盘与洞察

### 8.1 主摘要（一级页面）

#### 显示内容
```
┌─────────────────────────────────┐
│   🎉 今日学习完成                │
├─────────────────────────────────┤
│  完成曝光: 220 / 400            │
│  学习时长: 18分30秒              │
│  右滑（熟悉）: 145次             │
│  左滑（困难）: 75次              │
├─────────────────────────────────┤
│  困难 Top 10:                   │
│  1. abandonment (剩3次) 8.2s    │
│  2. resilient (剩4次) 6.5s      │
│  ...                            │
├─────────────────────────────────┤
│  [继续学习]  [查看详细洞察 →]    │
└─────────────────────────────────┘
```

### 8.2 专业洞察（二级页面）

#### 📊 效率曲线
```
每10分钟统计:
- 曝光数
- 右滑率
- 平均停留时长

→ 识别最佳学习时段
```

#### 🎯 节奏指数
| 指标 | 定义 | 目标 |
|------|------|------|
| **Flow** | 前5秒内右滑占比 | >60% |
| **Friction** | >8秒仍左滑占比 | <20% |

#### 🔍 困难词簇
```
按维度统计:
- 词性 (n/v/adj/adv)
- 主题 (学术/科技/社会)
- 词频段 (高频/中频/低频)

→ 发现薄弱环节
```

#### 📅 明日预测
```
• 预计复现需求: 150词
• 建议新词量: 50词
• 预估学习时长: 25分钟
```

#### 🌐 L1使用率
```
今日点按显示中文: 23次
目标: 逐日下降

趋势图:
Week 1: ████████░░ 80%
Week 2: ██████░░░░ 60%
Week 3: ████░░░░░░ 40%
```

#### 🔄 行为分析
```
• Skip次数: 3次
• Undo次数: 5次
• 长按发音: 12次
• 查看微场景: 8次
```

---

## 九、AI内容增强（Deep Seek API）

### 9.1 核心功能

NFwords使用**DeepSeek API**提供两大AI功能：
1. **微场景生成**：为困难单词生成沉浸式情景句
2. **考研风格阅读短文生成**：根据困难词汇生成符合国内考研英语阅读风格的短文

### 9.2 微场景生成

#### 触发条件
```swift
困难态 = (avgDwellTime > 8s) AND (leftSwipes >= 2)
```

#### DeepSeek API调用

```swift
class DeepSeekService {
    private let apiKey = "YOUR_DEEPSEEK_API_KEY"
    private let baseURL = "https://api.deepseek.com/v1/chat/completions"
    
    // 生成微场景
    func generateMicroScene(for word: String) async throws -> String {
        let prompt = """
        Generate a micro-scene sentence (80-120 characters) for the word "\(word)".
        Requirements:
        - Use second person ("You...")
        - Create an immersive scenario
        - Natural, conversational English
        - NO Chinese, NO explanation
        
        Example: "You stand on the platform in absolute silence; the announcement is barely audible."
        
        Word: \(word)
        Micro-scene:
        """
        
        let response = try await callDeepSeek(prompt: prompt)
        return response
    }
}
```

#### 请求格式
```json
{
  "model": "deepseek-chat",
  "messages": [
    {
      "role": "system",
      "content": "You are an English learning assistant that creates immersive micro-scenarios."
    },
    {
      "role": "user",
      "content": "Generate a micro-scene for: abandonment"
    }
  ],
  "temperature": 0.7,
  "max_tokens": 100
}
```

#### 响应缓存
```swift
struct MicroSceneCache: Codable {
    let wordId: Int
    let scene: String
    let createdAt: Date
    let expiresAt: Date  // 缓存7天
}

// 缓存策略
func getCachedMicroScene(wordId: Int) -> String? {
    if let cached = cache[wordId], cached.expiresAt > Date() {
        return cached.scene
    }
    return nil
}
```

### 9.3 考研风格阅读短文生成 ⭐核心功能

#### 功能定位

这是NFwords的**杀手锏功能**：根据用户的困难词汇（停留时间最长的前N个），生成符合**国内考研英语阅读风格**的短文，实现从"背单词"到"读文章"的无缝衔接。

#### 生成时机

1. **每日学习完成后**：自动生成包含当天困难词的短文
2. **计划完成后**：生成10篇综合性短文
3. **用户手动触发**：可自选单词生成

#### 短文特点

符合考研英语阅读特征：
- 📰 **题材**：社会、科技、经济、教育、环境等
- 📏 **长度**：300-400词（接近考研真题长度）
- 🎯 **难度**：CET-6 ~ 考研水平
- 📖 **结构**：引入 → 展开 → 论述 → 总结
- 🔤 **覆盖**：包含15-25个目标困难词汇

#### Deep Seek API调用

```swift
func generateReadingPassage(difficultWords: [String]) async throws -> ReadingPassage {
    let wordList = difficultWords.prefix(20).joined(separator: ", ")
    
    let prompt = """
    Create an English reading passage suitable for Chinese postgraduate entrance exam (考研).
    
    Requirements:
    1. Length: 300-400 words
    2. Style: Academic, formal, similar to The Economist or Scientific American
    3. Topic: Social issues, technology, economy, education, or environment
    4. Structure: Introduction → Development → Discussion → Conclusion
    5. Must naturally include these words: \(wordList)
    6. Difficulty: CET-6 to postgraduate level
    7. NO translation, English only
    
    The passage should:
    - Present a clear argument or phenomenon
    - Use complex sentences and academic vocabulary
    - Include logical connectors
    - Be suitable for comprehension questions
    
    Generate the passage:
    """
    
    let response = try await callDeepSeek(prompt: prompt, maxTokens: 600)
    
    return ReadingPassage(
        content: response,
        targetWords: difficultWords,
        wordCount: countWords(response),
        difficulty: .postgraduate,
        topic: detectTopic(response)
    )
}
```

#### 示例输出

```markdown
**Generated Reading Passage** (Based on difficult words: abandonment, resilient, elaborate, deteriorate...)

The Economic Resilience of Small Businesses During Crises

In recent years, economic downturns have led to the abandonment of numerous business ventures, particularly among small enterprises lacking robust financial reserves. However, research reveals that resilient organizations often survive these challenging periods through elaborate strategic planning and adaptive management.

When market conditions deteriorate, successful businesses demonstrate remarkable capacity to pivot their operations. Rather than succumbing to immediate pressures, they systematically evaluate their circumstances and implement comprehensive recovery plans. This phenomenon illustrates a fundamental principle: economic survival depends not merely on avoiding hardship, but on developing mechanisms to persevere through adversity.

Contemporary studies emphasize that business resilience emerges from several interconnected factors...

[300-400 words total]

---

**Vocabulary Coverage:**
✓ abandonment (line 2)
✓ resilient (line 3)
✓ elaborate (line 4)
✓ deteriorate (line 6)
...
```

#### 用户界面

```
┌──────────────────────────────────────────┐
│  📖 考研风格阅读短文                      │
├──────────────────────────────────────────┤
│                                          │
│  基于您的困难词汇自动生成                 │
│                                          │
│  📊 今日生成                              │
│  ┌────────────────────────────────────┐  │
│  │  Passage 1: 经济韧性                 │  │
│  │  包含单词: 18个                      │  │
│  │  字数: 352词                         │  │
│  │  难度: 考研水平                       │  │
│  │                                     │  │
│  │  [阅读全文]  [单词标注]  [收藏]     │  │
│  └────────────────────────────────────┘  │
│                                          │
│  🎯 手动生成                              │
│  ┌────────────────────────────────────┐  │
│  │  选择单词: [从困难词列表选择]        │  │
│  │  已选: 15个                          │  │
│  │                                     │  │
│  │  主题: [自动] ▼                      │  │
│  │  • 社会议题                          │  │
│  │  • 科技发展                          │  │
│  │  • 经济现象                          │  │
│  │  • 教育改革                          │  │
│  │  • 环境保护                          │  │
│  │                                     │  │
│  │  [生成新短文]                        │  │
│  └────────────────────────────────────┘  │
│                                          │
│  📚 历史短文 (共 12 篇)                   │
│  ┌────────────────────────────────────┐  │
│  │  • 科技创新与社会变革 (11-03)        │  │
│  │  • 教育公平的挑战 (11-02)            │  │
│  │  • 环境治理的新思路 (11-01)          │  │
│  │  [查看全部]                          │  │
│  └────────────────────────────────────┘  │
└──────────────────────────────────────────┘
```

#### 阅读界面

```
┌──────────────────────────────────────────┐
│  ← 返回    经济韧性              ⋯ 更多   │
├──────────────────────────────────────────┤
│                                          │
│  The Economic Resilience of Small        │
│  Businesses During Crises                │
│                                          │
│  In recent years, economic downturns     │
│  have led to the [abandonment] of        │  ← 困难词高亮
│  numerous business ventures...           │
│                                          │
│  However, research reveals that          │
│  [resilient] organizations often         │  ← 点击查看释义
│  survive these challenging periods...    │
│                                          │
│  [全文约350词]                           │
│                                          │
├──────────────────────────────────────────┤
│  📌 单词标注 (18个)                       │
│  ┌────────────────────────────────────┐  │
│  │  abandonment  第2行  停留12.5秒 ⚠️  │  │
│  │  resilient    第4行  停留9.8秒  ⚠️  │  │
│  │  elaborate    第5行  停留8.3秒  ⚠️  │  │
│  │  ...                                │  │
│  └────────────────────────────────────┘  │
│                                          │
│  [朗读全文]  [导出PDF]  [做练习题]       │
└──────────────────────────────────────────┘
```

### 9.4 API配置与管理

#### DeepSeek API设置

**API Key配置**：
```swift
struct DeepSeekConfig {
    // ⚠️ 生产环境请使用环境变量或Keychain存储
    // 开发环境可以直接配置
    static let apiKey = "sk-ca514461699d4d39bd03936acfaa6616"
    static let baseURL = "https://api.deepseek.com/v1/chat/completions"
    static let model = "deepseek-chat"
    static let timeout: TimeInterval = 30.0
    
    // 限流配置
    static let maxRequestsPerDay = 100  // 每天最多100次请求
    static let cacheExpirationDays = 7   // 缓存7天
}
```

**环境变量配置（推荐）**：
```swift
// 方式1: 使用环境变量（推荐用于生产环境）
static let apiKey = ProcessInfo.processInfo.environment["DEEPSEEK_API_KEY"] 
    ?? "sk-ca514461699d4d39bd03936acfaa6616"

// 方式2: 使用Keychain（最安全）
static let apiKey: String = {
    if let key = KeychainHelper.get("DEEPSEEK_API_KEY") {
        return key
    }
    return "sk-ca514461699d4d39bd03936acfaa6616"
}()
```

**配置步骤**：
1. 在Xcode中添加环境变量：Edit Scheme → Run → Arguments → Environment Variables
2. 添加 `DEEPSEEK_API_KEY = sk-ca514461699d4d39bd03936acfaa6616`
3. 或直接在代码中使用（开发阶段）

#### 费用优化策略

```swift
class AIRequestManager {
    private var dailyRequestCount = 0
    private let maxDailyRequests = 100
    
    func canMakeRequest() -> Bool {
        return dailyRequestCount < maxDailyRequests
    }
    
    // 优先使用缓存
    func getContent(type: ContentType, key: String) async -> String? {
        // 1. 检查缓存
        if let cached = cache.get(key), !cached.isExpired {
            return cached.content
        }
        
        // 2. 检查请求限额
        guard canMakeRequest() else {
            return getFallbackContent(type: type)
        }
        
        // 3. 调用API
        let content = try? await callDeepSeek(...)
        dailyRequestCount += 1
        
        // 4. 缓存结果
        if let content = content {
            cache.set(key, content, expiresIn: 7.days)
        }
        
        return content
    }
    
    // 失败回退
    func getFallbackContent(type: ContentType) -> String {
        switch type {
        case .microScene:
            return getLocalTemplateScene()
        case .readingPassage:
            return "请求已达上限，请明天再试"
        }
    }
}
```

### 9.5 数据模型

```swift
struct ReadingPassage: Codable, Identifiable {
    let id: UUID
    let content: String              // 短文内容
    let targetWords: [String]        // 目标单词列表
    let wordCount: Int               // 字数
    let difficulty: DifficultyLevel  // 难度等级
    let topic: Topic                 // 主题分类
    let createdAt: Date
    var isFavorite: Bool             // 是否收藏
}

enum Topic: String, Codable {
    case social = "社会议题"
    case technology = "科技发展"
    case economy = "经济现象"
    case education = "教育改革"
    case environment = "环境保护"
    case culture = "文化现象"
}

enum DifficultyLevel: String, Codable {
    case cet4 = "CET-4"
    case cet6 = "CET-6"
    case postgraduate = "考研"
    case toefl = "TOEFL"
}
```

---

## 十、复盘与洞察

### 10.1 主摘要（一级页面）- 参考架构总览设计

#### 显示内容
```
┌──────────────────────────────────────────┐
│  📊 今日学习报告                         │
├──────────────────────────────────────────┤
│  完成：310词  3,100次  45分钟             │
│  平均停留：3.8秒 ✅                       │
│                                          │
│  ✅ 熟悉（280个）停留<2s                 │
│  1. ability    →9  1.2s                 │
│  2. accomplish →8  1.5s                 │
│  3. achieve    →7  1.8s                 │
│  ...                                     │
│                                          │
│  ⚠️ 需加强（30个）停留>3s ⭐             │
│  1. resilient     ←6  5.2s              │
│  2. elaborate     ←8  4.8s              │
│  3. deteriorate   ←5  4.3s              │
│  4. catastrophe   ←3  3.9s              │
│  5. abandonment   ←7  3.7s              │
│  ...                                     │
│  [查看完整列表]                          │
│                                          │
├──────────────────────────────────────────┤
│  💡 建议                                 │
│  • 30个困难词明日会重点复习               │
│  • 可生成AI考研短文加强理解               │
│                                          │
│  [生成考研短文]                          │  ← 用前10个最陌生的词
│                                          │
│  [继续学习]  [查看详细洞察 →]            │
└──────────────────────────────────────────┘
```

**说明**：
- **→9**: 右滑9次（熟悉）
- **←6**: 左滑6次（不熟悉）
- **停留时间**: 平均停留时长（秒）⭐ 核心排序依据
- **按停留时间降序排列**：停留越长越靠前，说明越需要复习

---

## 十一、用户认证系统

### 11.1 核心需求

NFwords要求用户**必须登录**才能使用，原因：
- 📊 同步学习数据到云端
- 📖 保存学习计划和进度
- 🤖 使用AI功能需要用户配额管理
- 📈 生成个性化学习报告

### 11.2 认证方式

#### 支持的登录方式

```
┌─────────────────────────────────┐
│  欢迎来到 NFwords                │
│                                 │
│  为应试考试而生的单词学习应用     │
│                                 │
│  [Apple 登录]     🍎            │  ← 推荐（快速、安全）
│                                 │
│  [微信登录]       💬            │  ← 国内用户首选
│                                 │
│  [手机号登录]     📱            │  ← 传统方式
│                                 │
│  ────────────────────           │
│                                 │
│  首次登录即表示同意              │
│  《用户协议》和《隐私政策》       │
└─────────────────────────────────┘
```

#### 技术实现

```swift
enum AuthProvider {
    case apple
    case wechat
    case phone
}

class AuthService: ObservableObject {
    @Published var isAuthenticated = false
    @Published var currentUser: User?
    
    // Apple Sign In
    func signInWithApple() async throws -> User {
        // 使用 AuthenticationServices
        let credential = try await ASAuthorizationController.performRequest()
        let user = try await verifyWithBackend(credential)
        self.currentUser = user
        self.isAuthenticated = true
        return user
    }
    
    // 微信登录
    func signInWithWechat() async throws -> User {
        // 调用微信SDK
        let code = try await WXApi.sendAuth()
        let user = try await exchangeCodeForToken(code)
        self.currentUser = user
        self.isAuthenticated = true
        return user
    }
    
    // 手机号登录
    func signInWithPhone(phone: String, code: String) async throws -> User {
        let user = try await backend.verifyPhoneCode(phone: phone, code: code)
        self.currentUser = user
        self.isAuthenticated = true
        return user
    }
}
```

### 11.3 用户数据模型

```swift
struct User: Codable, Identifiable {
    let id: String                    // 用户ID
    let username: String?             // 用户名
    let email: String?                // 邮箱
    let phone: String?                // 手机号
    let avatarURL: String?            // 头像
    let authProvider: AuthProvider    // 登录方式
    
    // 学习数据
    var studyPlans: [StudyPlan]       // 学习计划
    var totalStudyDays: Int           // 累计学习天数
    var currentStreak: Int            // 连续签到天数
    var totalWordsLearned: Int        // 累计学习单词数
    
    // AI配额
    var aiQuota: AIQuota              // AI使用配额
    
    // 会员信息
    var subscriptionStatus: SubscriptionStatus
    var subscriptionExpiresAt: Date?
    
    let createdAt: Date
    let lastLoginAt: Date
}

struct AIQuota: Codable {
    var dailyMicroScenes: Int         // 每日微场景生成次数
    var dailyReadingPassages: Int     // 每日短文生成次数
    var usedMicroScenes: Int          // 已使用次数
    var usedReadingPassages: Int      // 已使用次数
    var resetAt: Date                 // 重置时间（每日0点）
}
```

### 11.4 数据同步

```swift
class DataSyncService {
    // 自动同步策略
    func setupAutoSync() {
        // 1. 学习完成后自动同步
        NotificationCenter.default.addObserver(
            forName: .studySessionCompleted,
            object: nil,
            queue: .main
        ) { _ in
            Task {
                await self.syncStudyData()
            }
        }
        
        // 2. 应用进入后台时同步
        NotificationCenter.default.addObserver(
            forName: UIApplication.didEnterBackgroundNotification,
            object: nil,
            queue: .main
        ) { _ in
            Task {
                await self.syncAll()
            }
        }
        
        // 3. 每30分钟自动同步一次
        Timer.scheduledTimer(withTimeInterval: 1800, repeats: true) { _ in
            Task {
                await self.syncIfNeeded()
            }
        }
    }
    
    // 同步学习数据
    func syncStudyData() async throws {
        let localRecords = getLocalDwellTimeRecords()
        try await backend.uploadDwellTimeRecords(localRecords)
        
        let serverData = try await backend.fetchLatestData()
        mergeWithLocalData(serverData)
    }
}
```

### 11.5 会员体系（可选）

```
┌─────────────────────────────────┐
│  ⭐ NFwords Premium              │
├─────────────────────────────────┤
│                                 │
│  免费版：                        │
│  • 基础学习功能                  │
│  • 每日3篇AI短文                │
│  • 每日10次微场景                │
│                                 │
│  会员版（¥19/月）：              │
│  • 所有免费功能                  │
│  • 无限AI短文生成 ⭐             │
│  • 无限微场景生成 ⭐             │
│  • 导出学习报告                  │
│  • 多设备同步                    │
│  • 去除广告                      │
│                                 │
│  [开通会员]  [稍后再说]          │
└─────────────────────────────────┘
```

### 11.6 隐私与安全

```swift
class SecurityManager {
    // Token管理
    func storeAuthToken(_ token: String) {
        // 使用Keychain安全存储
        KeychainHelper.save(token, forKey: "auth_token")
    }
    
    // 敏感数据加密
    func encryptSensitiveData(_ data: Data) -> Data {
        // 使用AES加密
        return AESEncryption.encrypt(data)
    }
    
    // 定期刷新Token
    func refreshTokenIfNeeded() async throws {
        guard let token = getAuthToken(),
              token.isExpiringSoon else { return }
        
        let newToken = try await backend.refreshToken(token)
        storeAuthToken(newToken)
    }
}
```

---

## 十二、技术架构

### 10.1 技术栈

#### 前端
- **框架**: SwiftUI
- **最低版本**: iOS 16.0+
- **架构模式**: MVVM + Combine

#### 核心库
```swift
// 动画
import SwiftUI

// 发音
import AVFoundation

// 本地存储
import CoreData / SwiftData

// 网络
import Combine / async/await
```

### 10.2 数据模型

#### Word（单词）
```swift
struct Word: Identifiable, Codable {
    let id: Int  // wid
    let word: String
    let phonetic: String?
    let translations: [Translation]
    let phrases: [Phrase]
    let scenes: [Scene]
    let frequency: Int?
}
```

#### WordLearningRecord（学习记录）
```swift
struct WordLearningRecord: Codable {
    let id: Int  // wid
    var exposures: Int              // 总曝光次数
    var remainingExposures: Int     // 剩余出现次数
    var difficulty: Double          // 0-1连续分值
    var swipeRightCount: Int
    var swipeLeftCount: Int
    var avgDwellTime: Double
    var lastSwipeDirection: SwipeDirection?
    var recentLeftSwipes: Int       // 最近3次左滑计数
    var contentLevel: ContentLevel  // L1/L2展示等级
    var microScene: String?         // AI生成的微场景
    var lastUpdated: Date
}
```

#### StudyCard（学习卡片）
```swift
struct StudyCard: Identifiable {
    let id: Int
    let word: Word
    var record: WordLearningRecord
}
```

#### DailyReport（每日报告）
```swift
struct DailyReport: Codable {
    let date: Date
    let completedExposures: Int
    let targetBudget: Int
    let studyDuration: TimeInterval
    let rightSwipes: Int
    let leftSwipes: Int
    let difficultWords: [WordSummary]
    let insights: StudyInsights
}
```

### 10.3 核心算法

#### 调度算法
```swift
class ScheduleEngine {
    func buildDailyQueue(budget: Int) -> [StudyCard]
    func calculateDifficulty(record: WordLearningRecord) -> Double
    func determineContentLevel(record: WordLearningRecord) -> ContentLevel
    func optimizeSpacing(queue: [StudyCard]) -> [StudyCard]
}
```

#### Tinder式手势识别
```swift
class SwipeGestureHandler {
    // 滑动阈值判断
    func shouldTriggerSwipe(offset: CGFloat, velocity: CGFloat) -> Bool {
        return abs(offset) > 100 || abs(velocity) > 500
    }
    
    // 旋转角度计算（±15°）
    func calculateRotation(offset: CGFloat) -> Double {
        let maxRotation = 15.0
        let progress = min(abs(offset) / 200, 1.0)
        return (offset > 0 ? 1 : -1) * maxRotation * progress
    }
    
    // 方向图标透明度
    func calculateIconOpacity(offset: CGFloat) -> Double {
        return min(abs(offset) / 100, 1.0)
    }
}
```

#### 墨墨式翻转控制
```swift
class FlipController {
    @State private var isFlipped = false
    @State private var flipProgress: Double = 0
    
    func flip() {
        withAnimation(.easeInOut(duration: 0.3)) {
            isFlipped.toggle()
        }
    }
}
```

#### 内容渐隐算法
```swift
enum ContentLevel {
    case fullL1         // 完整中文
    case partialL1      // 部分中文（点按可见）
    case l2Only         // 纯英文
    case withL1AndScene // 中文+微场景（困难态临时放宽）
}
```

### 10.4 性能优化

#### 滑动性能（对标Tinder）
- **预加载**: 前3张卡片内容和布局
- **懒加载**: 微场景内容按需加载
- **动画优化**: 使用硬件加速的Transform动画
- **60 FPS**: 使用`@State`和`@Published`优化刷新
- **手势响应**: 零延迟跟手效果

#### 内存管理
- **队列限制**: 同时加载最多10张卡片
- **定期清理**: 完成的卡片及时释放
- **大数据分页**: 词书数据分批加载

---

## 十一、数据与隐私

### 11.1 隐私承诺

```
✅ 本地优先：学习数据默认存储在设备本地
✅ 匿名统计：仅收集匿名汇总数据用于改进
✅ 用户控制：可在设置中关闭"改进体验数据"
✅ 透明告知：隐私说明清晰列出所有数据用途
```

### 11.2 数据分类

| 数据类型 | 存储位置 | 是否上传 | 用途 |
|---------|---------|---------|------|
| 学习记录 | 本地 CoreData | ❌ | 个性化调度 |
| 事件流水 | 本地日志 | ⚠️ 匿名抽样 | 产品改进 |
| 词书数据 | 本地 + CDN | N/A | 学习内容 |
| AI生成内容 | 本地缓存 | ❌ | 微场景展示 |
| 统计指标 | 本地计算 | ⚠️ 匿名汇总 | 复盘洞察 |

### 11.3 事件追踪（匿名）

#### 收集的事件
```swift
enum CardEvent {
    case swipe(direction: SwipeDirection, dwellTime: TimeInterval)
    case tapTranslation  // 点按显示中文
    case playPronunciation
    case viewMicroScene
    case skip
    case undo
}
```

#### 上报策略
- **延迟上报**: 批量上报，减少网络请求
- **抽样上报**: 10%用户抽样统计
- **可关闭**: 设置中提供关闭选项

---

## 📐 UI/UX设计规范

### 配色方案（借鉴Tinder清晰的视觉反馈）

#### 主色调
```swift
// 背景渐变
LinearGradient(
    colors: [Color.blue.opacity(0.6), Color.purple.opacity(0.8)],
    startPoint: .topLeading,
    endPoint: .bottomTrailing
)

// 卡片
Color.white
.shadow(color: .black.opacity(0.1), radius: 20, y: 10)

// 滑动反馈色（Tinder式）
Color.green.opacity(0.2)   // 右滑背景（认识）
Color.orange.opacity(0.2)  // 左滑背景（不认识）

// 方向图标
Color.green  // ✓ 右滑图标
Color.orange // ✗ 左滑图标
```

#### 文字层级
```swift
.largeTitle   // 单词主体 (48pt, bold)
.title2       // 音标 (22pt, regular)
.body         // 释义/短语 (17pt)
.caption      // 次要信息 (12pt)
```

### 动画参数

#### Spring动画（Tinder式弹性）
```swift
// 卡片跟手滑动
.animation(.interactiveSpring(response: 0.3, dampingFraction: 0.8), value: offset)

// 卡片飞出
.animation(.spring(response: 0.35, dampingFraction: 0.75), value: offset)

// 堆叠卡片前移
.animation(.spring(response: 0.4, dampingFraction: 0.8), value: scale)
```

#### 翻转动画（墨墨式3D翻转）
```swift
.rotation3DEffect(
    .degrees(isFlipped ? 180 : 0),
    axis: (x: 0, y: 1, z: 0)
)
.animation(.easeInOut(duration: 0.3), value: isFlipped)
```

#### 渐变动画
```swift
// 方向图标淡入
.animation(.easeInOut(duration: 0.2), value: opacity)

// 背景色渐变
.animation(.linear(duration: 0.15), value: backgroundColor)
```

#### 卡片飞出（Tinder式）
```swift
// 右滑飞出
.offset(x: isSwipedRight ? 500 : 0, y: 0)
.rotationEffect(.degrees(isSwipedRight ? 15 : 0))
.opacity(isSwipedRight ? 0 : 1)

// 左滑飞出
.offset(x: isSwipedLeft ? -500 : 0, y: 0)
.rotationEffect(.degrees(isSwipedLeft ? -15 : 0))
.opacity(isSwipedLeft ? 0 : 1)
```

#### 方向提示动画（Tinder式）
```swift
// 滑动距离越大，图标越明显
let swipeProgress = min(abs(dragOffset) / 100, 1.0)
Image(systemName: dragOffset > 0 ? "checkmark" : "xmark")
    .opacity(swipeProgress)
    .scaleEffect(0.5 + swipeProgress * 0.5)
```

### 触感反馈矩阵

| 交互 | 触感类型 | 时机 |
|------|---------|------|
| 右滑卡片 | `.light` | 滑动距离>50% |
| 左滑卡片 | `.medium` | 滑动距离>50% |
| 困难触发 | `.warning` | 左滑第3次 |
| 点击按钮 | `.selection` | 点击时 |
| 长按单词 | `.rigid` | 长按触发 |

---

## 🗺️ 实现路线图（与总览对齐）

本路线图与【架构总览】文档完全对齐，确保前后端协同开发。

### MVP最小可用产品（4周）⭐

#### Week 1: 基础框架 + 用户认证
**后端**：
- [ ] 数据库初始化（21张表）
- [ ] 用户认证API（JWT）
- [ ] Apple ID / 微信 / 手机号登录

**iOS**：
- [x] 项目初始化（已完成）
- [ ] 登录界面UI
- [ ] AuthService实现

#### Week 2: Tinder式滑卡 ⭐ 核心功能
**iOS**：
- [ ] Tinder式卡片UI（3层堆叠，scale: 1.0/0.95/0.90）
- [ ] DragGesture左右滑动手势
- [ ] 停留时间追踪（onAppear/onDisappear）⭐
- [ ] 剩余次数显示（remaining_exposures）⭐
- [ ] 进度显示（50/3100）
- [ ] 卡片旋转动画（±15°）
- [ ] 方向提示（绿色✓/橙色✗）

**后端**：
- [ ] 词汇包API（vocabulary_packs表）

#### Week 3: 学习目标与任务系统
**后端**：
- [ ] learning_goals表API（创建/查询目标）
- [ ] daily_tasks表API（生成每日任务）
- [ ] 任务生成算法（10天3000词分配）
- [ ] 额度检查与占用机制

**iOS**：
- [ ] 创建学习目标界面
- [ ] 计划模板选择（7天/10天/20天/60天）
- [ ] 每日任务显示界面
- [ ] 队列生成算法（300×10+20×5）

#### Week 4: 学习记录与每日报告 ⭐
**后端**：
- [ ] word_learning_records表API
- [ ] 每日报告生成（按停留时间排序）⭐
- [ ] exposure_events批量上报

**iOS**：
- [ ] SwipeViewModel实现（记录swipe + dwell_time）
- [ ] 每日报告界面（停留时间排序）
- [ ] 困难词列表（熟悉280个 + 需加强30个）
- [ ] 停留时间可视化（分布柱状图）

### AI增强与完善（4周）

#### Week 5: DeepSeek AI短文生成 ⭐ 杀手锏
**后端**：
- [ ] DeepSeek API集成
- [ ] ai_generated_articles表
- [ ] 短文生成接口（/api/v1/ai/generate-article）
- [ ] 短文质量验证（词汇覆盖、长度检查）

**iOS**：
- [ ] DeepSeekConfig配置（API Key已提供）
- [ ] 生成短文界面（选择词汇+主题）
- [ ] 阅读界面（高亮目标词）
- [ ] AI配额管理与显示
- [ ] 短文收藏与历史

#### Week 6: 词库管理与规划
**后端**：
- [ ] word_plans表API
- [ ] user_packs表API
- [ ] 规划同步接口

**iOS**：
- [ ] 词库选择界面（墨墨式）
- [ ] 词库详情页
- [ ] 自定义词库导入（Excel/CSV/TXT）
- [ ] 额度显示与管理

#### Week 7: 离线支持与数据同步 ⭐
**iOS**：
- [ ] SwiftData本地存储（9张本地表）
- [ ] 离线学习完整支持
- [ ] 后台自动同步策略
- [ ] 冲突处理与回滚

**后端**：
- [ ] 批量同步API
- [ ] 冲突检测与合并

#### Week 8: 测试、优化与发布
- [ ] 全流程端到端测试
- [ ] 性能优化（60fps滑动）
- [ ] 内存优化（<150MB）
- [ ] Bug修复与polishing
- [ ] App Store资源准备
- [ ] TestFlight内测

---

## 🎯 成功指标

### 用户体验指标
- **Flow率**: >60%（前5秒内右滑比例）
- **平均停留时长**: 3-5秒
- **日完成率**: >80%（完成每日预算）
- **L1点按下降**: 每周-20%

### 技术指标（对标Tinder性能）
- **滑卡帧率**: 稳定60 FPS（Tinder级别）
- **手势响应**: <16ms延迟（零感知）
- **动画流畅度**: 120fps ProMotion支持
- **崩溃率**: <0.1%
- **启动时间**: <2秒
- **内存占用**: <150MB

### 学习效果指标
- **7日留存**: >40%
- **30日留存**: >20%
- **单词记忆率**: >75%（7天后测试）

---

## 📚 参考资源

### 设计灵感

#### 核心参考（重点借鉴）
- **Tinder**: 
  - ✅ 卡片堆叠效果（3张卡片渐进式缩放）
  - ✅ 流畅的左右滑动手势（±15°旋转）
  - ✅ 清晰的方向提示（绿色✓/橙色✗）
  - ✅ 卡片飞出动画（spring弹性效果）
  
- **墨墨背单词**:
  - ✅ 点击翻转查看释义（3D翻转动画）
  - ✅ 渐进式内容展示（L1→L2淡化）
  - ✅ 场景化例句学习
  - ✅ 统计可视化复盘

#### 辅助参考
- **Duolingo**: 游戏化学习、每日目标
- **Anki**: 间隔重复算法、复现策略
- **Readwise**: 渐进式阅读理念

### 技术文档
- [SwiftUI官方文档](https://developer.apple.com/documentation/swiftui)
- [Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines)
- [AVSpeechSynthesizer文档](https://developer.apple.com/documentation/avfoundation/avspeechsynthesizer)

---

## 👥 团队协作

### 角色分工
- **iOS工程师**: SwiftUI开发、性能优化
- **UI/UX设计师**: 视觉设计、交互原型
- **算法工程师**: 调度算法、数据分析
- **AI工程师**: 微场景生成、内容推荐

### 开发流程
1. **需求评审** → 确认功能范围
2. **设计评审** → 确认交互与视觉
3. **技术评审** → 确认技术方案
4. **开发迭代** → 2周一个Sprint
5. **测试发布** → TestFlight内测 → AppStore发布

---

## 📄 许可证

MIT License - 详见 LICENSE 文件

---

## 📮 联系我们

- **Email**: support@nfwords.app
- **GitHub**: [NFwordsApp](https://github.com/NFwordsApp)
- **Twitter**: @NFwords

---

## 🔄 完整学习流程（端到端）

基于【架构总览】设计：

```
用户登录（必须）
    ↓
创建学习目标（10天3000词）
    ├─ 选择词库：CET-4（3000词）
    ├─ 设置天数：10天
    ├─ 检查额度：剩余6120 >= 3000？✅
    ├─ 占用额度：planned_words = 3000
    └─ 后端生成10天任务（算法计算）
    ↓
第1天：打开App
    ├─ 查询今日任务：300新词 + 0复习
    ├─ 生成学习队列：300词 × 10次 = 3000次滑卡
    └─ 开始Tinder式滑卡学习
    ↓
滑卡学习（记录停留时间）⭐
    ├─ 右滑：会写 ✅ → swipe_right_count++
    ├─ 左滑：不会写 ❌ → swipe_left_count++
    ├─ 记录停留时间 → avg_dwell_time计算
    ├─ 剩余次数减少 → remaining_exposures--
    └─ 实时显示：剩 7 次，进度 1/3000
    ↓
完成第1天（3000次滑卡）
    ├─ 生成每日报告（按停留时间排序）⭐
    ├─ 停留最长的30个单词 → 标记为"需加强"
    ├─ 停留最短的270个单词 → 标记为"熟悉"
    └─ 可选：生成AI考研短文（用最陌生的10词）
    ↓
第2天：打开App
    ├─ 查询今日任务：300新词 + 20复习
    ├─ 复习来源：昨天停留最长的20个词 ⭐
    ├─ 生成队列：300×10 + 20×5 = 3100次滑卡
    └─ 继续学习
    ↓
... 重复3-9天 ...
    ↓
第10天：完成目标
    ├─ goal_status = 'completed'
    ├─ 掌握3000个单词
    ├─ 释放额度：planned_words = 0
    ├─ 生成10篇AI考研短文（综合复习）
    └─ 可以创建新目标
```

**关键数据流**：
```
用户操作 → iOS本地记录 → 联网时同步 → 后端存储 → AI分析

具体：
  右滑卡片（会写）
    ↓
  iOS记录：exposure_events_local
    - swipe_direction = 'right'
    - dwell_time = 2.3s
    - timestamp
    ↓
  更新：word_learning_records
    - swipe_right_count++
    - remaining_exposures--
    - avg_dwell_time = (old_avg * count + 2.3) / (count + 1)
    ↓
  联网时批量上报 → 后端exposure_events表
    ↓
  后端生成每日报告 → 按停留时间排序 ⭐
    ↓
  明日任务算法 → 选择停留时间最长的词复习
```

---

## 🚀 开发优先级（MVP - 8周）

基于【架构总览】的开发计划：

### Phase 1: 核心MVP（4周）

#### Week 1: 用户认证与基础框架
- [x] 后端：用户认证API（JWT）
- [ ] 后端：数据库初始化（21张表）
- [ ] iOS：项目架构搭建（MVVM + SwiftData）
- [ ] iOS：登录界面（Apple ID + 微信 + 手机号）
- [ ] 配置：DeepSeek API Key集成

#### Week 2: Tinder式滑卡 ⭐ 核心功能
- [ ] iOS：Tinder式卡片UI（3层堆叠）
- [ ] iOS：左右滑动手势（DragGesture）
- [ ] iOS：停留时间追踪（onAppear/onDisappear）⭐
- [ ] iOS：剩余次数显示（remaining_exposures）⭐
- [ ] iOS：进度显示（50/3100）
- [ ] 后端：词汇包API

#### Week 3: 学习目标与任务系统
- [ ] 后端：学习目标API（learning_goals表）
- [ ] 后端：任务生成算法（10天3000词）
- [ ] 后端：每日任务API（daily_tasks表）
- [ ] iOS：目标创建界面
- [ ] iOS：每日任务显示
- [ ] iOS：队列生成算法（300×10+20×5）

#### Week 4: 每日报告（停留时间排序）⭐
- [ ] 后端：学习记录API（word_learning_records）
- [ ] 后端：每日报告生成（按停留时间排序）⭐
- [ ] iOS：学习数据记录（swipe + dwell_time）
- [ ] iOS：每日报告界面
- [ ] iOS：停留时间可视化（分布图）

### Phase 2: AI增强功能（2周）

#### Week 5: AI考研短文生成 ⭐ 杀手锏
- [ ] 后端：DeepSeek API集成
- [ ] 后端：AI短文生成接口
- [ ] 后端：短文质量验证
- [ ] iOS：生成短文界面
- [ ] iOS：阅读界面（高亮目标词）
- [ ] iOS：AI配额管理

#### Week 6: 词库管理与规划
- [ ] 后端：规划API（word_plans）
- [ ] 后端：额度检查与占用
- [ ] iOS：词库选择界面
- [ ] iOS：规划UI
- [ ] iOS：额度显示

### Phase 3: 完善与优化（2周）

#### Week 7: 离线支持与同步 ⭐
- [ ] 后端：同步API
- [ ] iOS：SwiftData本地存储（9张表）
- [ ] iOS：离线学习支持
- [ ] iOS：后台自动同步
- [ ] iOS：冲突处理

#### Week 8: 测试与发布
- [ ] 全流程测试
- [ ] 性能优化（60fps）
- [ ] Bug修复
- [ ] App Store准备
- [ ] TestFlight内测

---

## 📊 核心特性对比（NFwords vs 传统App）

| 维度 | 传统App | NFwords ⭐ |
|------|---------|-----------|
| **交互方式** | 点击"认识/不认识" | **Tinder式左右滑动** |
| **学习目标** | 每日多少个（不确定） | **10天3000词明确目标** |
| **复习策略** | 艾宾浩斯遗忘曲线 | **停留时间长的优先复习** ⭐ |
| **内容强化** | 固定例句 | **AI考研短文（最陌生10词）** |
| **进度显示** | 打勾标记 | **显示剩余曝光次数（剩8次）** |
| **任务分配** | 自由学习，随意 | **算法提前分配每日任务** |
| **曝光次数** | 5-7次 | **10-20次高频重复** |
| **记忆理论** | 长期记忆保持 | **短期应试记忆（2-6月）** |

---

## 🔗 与架构总览文档的对应关系

| 总览章节 | README对应章节 | 状态 |
|---------|---------------|------|
| 产品定位 | 设计理念 | ✅ 已同步 |
| 12个核心要点 | 各功能章节 | ✅ 已覆盖 |
| 5个核心界面 | Tab 1-4页面设计 | ✅ 已同步 |
| 完整学习流程 | 完整学习流程章节 | ✅ 新增 |
| AI短文生成流程 | 九、AI内容增强 | ✅ 已详细说明 |
| 关键算法 | 六、学习计划与任务调度 | ✅ 已实现 |
| 数据结构 | 十二、技术架构 | ✅ 已定义 |
| 开发优先级 | 开发优先级章节 | ✅ 新增 |

---

## 🎯 关键数据模型（与后端对齐）

### 学习记录（word_learning_records）
```swift
struct WordLearningRecord: Codable {
    let wid: Int                    // 单词ID
    var swipeRightCount: Int        // 右滑次数（会写）
    var swipeLeftCount: Int         // 左滑次数（不会写）
    var totalExposureCount: Int     // 总曝光次数
    var remainingExposures: Int     // 剩余出现次数 ⭐
    var avgDwellTime: Double        // 平均停留时间（秒）⭐
    var isMastered: Bool            // 是否已掌握
    var lastStudyDate: Date         // 最后学习日期
}
```

### 每日报告（daily_reports）
```swift
struct DailyReport: Codable {
    let reportDate: Date
    let totalWordsStudied: Int      // 今日学习单词数
    let totalExposures: Int         // 总曝光次数
    let studyDuration: TimeInterval // 学习时长
    
    // 按停留时间排序的单词列表 ⭐ 核心
    let sortedByDwellTime: [WordSummary]
    
    let unfamiliarWords: [Int]      // 需加强（停留>5s）
    let familiarWords: [Int]        // 熟悉的（停留<2s）
}

struct WordSummary: Codable {
    let wid: Int
    let word: String
    let avgDwellTime: Double        // ⭐ 排序依据
    let swipeLeft: Int
    let swipeRight: Int
}
```

### 学习目标（learning_goals）
```swift
struct LearningGoal: Codable {
    let id: Int
    let packId: Int                 // 词库ID
    let totalWords: Int             // 总词数（如3000）
    let durationDays: Int           // 天数（如10天）
    let dailyNewWords: Int          // 每日新词（300）
    let startDate: Date
    let endDate: Date
    var status: GoalStatus          // in_progress/completed/abandoned
    var currentDay: Int             // 当前第几天
    var completedWords: Int         // 已完成单词数
}
```

---

## 📱 DeepSeek API 配置指南

### 配置文件位置

创建 `DeepSeekConfig.swift`:

```swift
//
//  DeepSeekConfig.swift
//  NFwordsDemo
//
//  DeepSeek API配置
//

import Foundation

struct DeepSeekConfig {
    // API配置
    static let apiKey = "sk-ca514461699d4d39bd03936acfaa6616"
    static let baseURL = "https://api.deepseek.com/v1/chat/completions"
    static let model = "deepseek-chat"
    
    // 超时设置
    static let timeout: TimeInterval = 30.0
    
    // 限流配置
    static let maxRequestsPerDay = 100      // 每天最多100次
    static let maxMicroScenesPerDay = 20    // 微场景20次
    static let maxArticlesPerDay = 10       // 短文10次
    
    // 缓存设置
    static let cacheExpirationDays = 7      // 缓存7天
    
    // Prompt模板
    static let microScenePrompt = """
    Generate a micro-scene sentence (80-120 characters) for the word "%@".
    Requirements:
    - Use second person ("You...")
    - Create an immersive scenario
    - Natural English only
    
    Word: %@
    Micro-scene:
    """
    
    static let articlePrompt = """
    Create an English reading passage for Chinese postgraduate exam (考研).
    
    Requirements:
    1. Length: 300-400 words
    2. Style: Academic, similar to The Economist
    3. Must include: %@
    4. Difficulty: CET-6 to postgraduate
    5. English only
    
    Generate:
    """
}
```

### 环境变量配置（生产环境推荐）

1. **Xcode配置**：
   - Edit Scheme → Run → Arguments
   - Add Environment Variable: 
     - Name: `DEEPSEEK_API_KEY`
     - Value: `sk-ca514461699d4d39bd03936acfaa6616`

2. **代码读取**：
```swift
static let apiKey = ProcessInfo.processInfo.environment["DEEPSEEK_API_KEY"] 
    ?? "sk-ca514461699d4d39bd03936acfaa6616"
```

---

---

## 🚀 快速开始指南

### 开发环境要求

- **macOS**: 14.0+ (Sonoma)
- **Xcode**: 15.0+
- **iOS Target**: 16.0+
- **Swift**: 5.9+

### 项目设置

#### 1. Clone项目
```bash
cd /Users/jefferygan/xcode4ios/NFwordsDemo
open NFwordsDemo.xcodeproj
```

#### 2. 配置DeepSeek API
API Key已配置在 `Services/DeepSeekConfig.swift`:
```swift
static let apiKey = "sk-ca514461699d4d39bd03936acfaa6616"
```

#### 3. 安装依赖（如需要）
```bash
# 使用Swift Package Manager
# File → Add Packages → 添加所需依赖
```

#### 4. 运行项目
- 选择目标设备（iPhone 15 Pro推荐）
- Cmd + R 运行

### 开发顺序（推荐）

#### 第一步：搭建Tinder式滑卡（Week 2）
```swift
// 1. 创建 SwipeCardView.swift
// 2. 实现卡片堆叠（ZStack + offset + scale）
// 3. 添加DragGesture
// 4. 实现停留时间追踪
// 5. 显示剩余次数
```

#### 第二步：学习目标与任务（Week 3）
```swift
// 1. 创建 LearningGoalView.swift
// 2. 创建 DailyTaskView.swift
// 3. 实现任务生成算法
// 4. 实现队列管理
```

#### 第三步：每日报告（Week 4）
```swift
// 1. 创建 DailyReportView.swift
// 2. 实现停留时间排序
// 3. 显示熟悉/困难词列表
// 4. 添加"生成AI短文"按钮
```

#### 第四步：DeepSeek AI集成（Week 5）
```swift
// 1. 使用 Services/DeepSeekConfig.swift
// 2. 创建 DeepSeekService.swift
// 3. 实现短文生成
// 4. 创建阅读界面
```

### 关键文件结构

```
NFwordsDemo/
├── Models/
│   ├── Word.swift                      ← 单词模型
│   ├── StudyCard.swift                 ← 学习卡片
│   ├── WordLearningRecord.swift        ← 学习记录 ⭐
│   ├── LearningGoal.swift              ← 学习目标 ⭐ NEW
│   ├── DailyTask.swift                 ← 每日任务 ⭐ NEW
│   ├── DailyReport.swift               ← 每日报告 ⭐ NEW
│   └── ReadingPassage.swift            ← AI短文 ⭐ NEW
│
├── ViewModels/
│   ├── StudyViewModel.swift            ← 学习逻辑
│   ├── DwellTimeTracker.swift          ← 停留时间追踪 ⭐ NEW
│   ├── TaskScheduler.swift             ← 任务调度 ⭐ NEW
│   └── ReportViewModel.swift           ← 报告生成 ⭐ NEW
│
├── Views/
│   ├── ContentView.swift               ← 主界面（Tab导航）
│   ├── SwipeCardsView.swift            ← Tinder式滑卡 ⭐
│   ├── WordCardView.swift              ← 单张卡片
│   ├── LearningGoalView.swift          ← 学习目标 ⭐ NEW
│   ├── DailyTaskView.swift             ← 每日任务 ⭐ NEW
│   ├── DailyReportView.swift           ← 每日报告 ⭐ NEW
│   ├── ReadingPassageView.swift        ← AI短文阅读 ⭐ NEW
│   ├── BookLibraryView.swift           ← 词库管理（墨墨式）
│   ├── StatisticsView.swift            ← 统计页面（墨墨式）
│   └── ProfileView.swift               ← 个人中心（墨墨式）
│
├── Services/
│   ├── DeepSeekConfig.swift            ← DeepSeek配置 ⭐ NEW
│   ├── DeepSeekService.swift           ← AI服务 ⭐ NEW
│   ├── AuthService.swift               ← 认证服务 ⭐ NEW
│   ├── DataSyncService.swift           ← 数据同步 ⭐ NEW
│   └── LocalStorageService.swift       ← 本地存储 ⭐ NEW
│
└── NFwordsDemoApp.swift                ← App入口
```

### 测试数据

项目已包含5个示例单词（Word.examples），可用于UI测试：
- abandonment（放弃）
- resilient（有韧性的）
- elaborate（精心制作的）
- abolish（废除）
- accomplish（完成）

### 调试技巧

```swift
// 1. 打印停留时间
print("⏱️ 单词 \(wordId) 停留 \(dwellTime)秒")

// 2. 打印学习记录
print("📊 右滑:\(swipeRight) 左滑:\(swipeLeft) 平均:\(avgDwell)s")

// 3. 打印每日报告
print("📄 熟悉:\(familiar.count) 困难:\(difficult.count)")

// 4. 打印DeepSeek响应
print("🤖 AI生成:\n\(response)")
```

---

## 📚 相关文档索引

### 核心文档
1. **README.md**（本文档）- 完整的前端设计文档
2. **【总览】NFwords架构设计总结.md** - 架构总览与核心要点
3. **Services/DeepSeekConfig.swift** - DeepSeek API配置文件

### 必读文档（来自架构总览）
1. NFwords完整架构设计（终稿）.md - 完整架构设计
2. 【必读】数据库设计终稿.md - 数据库总览与设计
3. 离线额度管理方案.md - 离线逻辑与同步策略

---

## 🎯 核心功能Checklist

基于【架构总览】的12个核心要点：

- [ ] 1. Tinder式左右滑动（DragGesture + swipe_direction）
- [ ] 2. 短期记忆应试（learning_goals表，目标导向）
- [ ] 3. 停留时间记录排序（avg_dwell_time字段 + 报告排序）⭐
- [ ] 4. 生成时间表（daily_reports表，sorted_by_dwell_time）
- [ ] 5. 考研风格短文（ai_generated_articles + DeepSeek）⭐
- [ ] 6. 提前定好任务（daily_tasks表，算法生成10天任务）
- [ ] 7. 多看不死记（remaining_exposures，10-20次曝光）
- [ ] 8. 参考市面App（Tinder交互 + 墨墨管理）
- [ ] 9. 必须登录（JWT认证，token验证）
- [ ] 10. DeepSeek API（API Key已配置）
- [ ] 11. 摈弃艾宾浩斯（用曝光次数，不用遗忘曲线）
- [ ] 12. 显示剩余次数（remaining_exposures UI显示）

---

## 💡 设计完成度

### ✅ 已完成
- ✅ 产品定位明确
- ✅ 用户画像清晰
- ✅ 核心功能定义
- ✅ 交互逻辑设计
- ✅ UI界面设计（4个Tab + 子页面）
- ✅ 数据模型设计
- ✅ 核心算法设计（停留时间追踪、任务调度）
- ✅ AI功能设计（微场景、考研短文）
- ✅ DeepSeek API配置
- ✅ 开发路线图（8周计划）
- ✅ 与架构总览文档对齐

### 🚧 待开发
- 开始编码实现（按Week 1-8顺序）

---

**最后更新**: 2025年11月3日  
**版本**: v1.0.0-MVP-Design  
**DeepSeek API**: ✅ 已配置（sk-ca514461699d4d39bd03936acfaa6616）  
**架构总览**: ✅ 已同步  
**状态**: ✅ 设计完成，可以开发  

---

## 🎉 开始开发！

**推荐阅读顺序**：
1. 本README（前端设计）
2. 【总览】NFwords架构设计总结.md（架构概览）
3. 开始编码（从Week 1开始）

**开发优先级**：
Week 2 > Week 4 > Week 5（滑卡 > 报告 > AI短文）

**祝开发顺利！** 🚀


